"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null},map=void 0,restaurantId=parseInt(getParameterByName("id")),dbHelper=new DBHelper;self.reviews=[],window.initMap=function(){fetchRestaurantFromURL(function(e,t){e?(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),dbHelper.mapMarkerForRestaurant(self.restaurant,self.map)):console.error(t)})};var fillRestaurantErrorHTML=function(){document.getElementById("restaurant-name").innerHTML="No restaurant found!";var e=document.getElementById("reviews-container");e.parentNode.removeChild(e)},fetchRestaurantFromURL=function(r){!restaurantId||isNaN(restaurantId)?fillRestaurantErrorHTML():(document.getElementById("restaurant_id").value=restaurantId,dbHelper.fetchRestaurantById(restaurantId,function(e,t){if(!e||t){if(!e&&!self.restaurant)return console.error(t),void fillRestaurantErrorHTML();self.restaurant=t,fillRestaurantHTML(),r(!0,t)}}))},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("restaurant-pic-container"),r=document.getElementById("favourite-restaurant");if(r.checked="true"===e.is_favorite||"boolean"==typeof e.is_favorite&&e.is_favorite,null===t.querySelector("picture")){document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var n=dbHelper.imageNameForRestaurant(e),a=document.createElement("picture"),i=document.createElement("source");i.setAttribute("media","(max-width:750px)"),i.setAttribute("srcset","/img/"+n+"-650.webp 1x, /img/"+n+"-800.webp 2x");var o=document.createElement("source");o.setAttribute("media","(max-width:1200px)"),o.setAttribute("srcset","/img/"+n+"-550.webp 1x, /img/"+n+"-800.webp 2x");var l=document.createElement("img");l.src="/img/"+n+"-800.webp",l.className="restaurant-img",l.id="restaurant-img",l.alt=e.name,a.append(i),a.append(o),a.append(l),t.prepend(a),document.getElementById("map-container").setAttribute("aria-label","Google Maps showing "+e.name+"'s location"),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type+" Restaurant",e.operating_hours&&fillRestaurantHoursHTML(),r.addEventListener("change",togglefavouriteRestaurant),dbHelper.submitCachedReview(restaurantId),dbHelper.submitCachedFavouriteRestaurant(restaurantId),fillReviewsHTML()}},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var r in e){var n=document.createElement("tr"),a=document.createElement("td");a.innerHTML=r,n.appendChild(a);var i=document.createElement("td");i.innerHTML=e[r],n.appendChild(i),t.appendChild(n)}},fillReviewsHTML=function(){dbHelper.fetchReviewsByRestaurantId(restaurantId,function(e){var t=_slicedToArray(e,2),r=t[0],n=void 0!==r&&r,a=t[1],i=(document.getElementById("reviews-container"),document.getElementById("reviews-list"));if(n&&!a){i.innerHTML="";var o=document.createElement("li");return o.id="no-reviews-yet",o.innerHTML="No reviews yet. Be the first one!",void i.appendChild(o)}!n||a instanceof Error?console.error(a):(a.sort(function(e,t){return e.createdAt-t.createdAt}),i.innerHTML="",a.forEach(function(e){i.appendChild(createReviewHTML(e))}),self.reviews=a)})},createReviewHTML=function(e){var t=document.createElement("li");t.id="review-"+e.id;var r=document.createElement("div");r.className="reviews-author",r.innerHTML=e.name,t.appendChild(r);var n=document.createElement("small");n.className="reviews-date";var a=new Date(e.createdAt);n.innerHTML=a.toLocaleDateString()+" - "+a.toLocaleTimeString(),r.appendChild(n);var i=document.createElement("p");i.innerHTML=e.comments,t.appendChild(i);var o=document.createElement("span");return o.className="reviews-rating",o.title="Rating: "+e.rating,o.setAttribute("aria-label",o.title),o.innerHTML="&#9733;".repeat(parseInt(e.rating))+"&#9734;".repeat(5-parseInt(e.rating)),t.appendChild(o),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb");if(null===t.querySelector("#crumb-restaurant-"+restaurantId)){var r=document.createElement("li");r.id="crumb-restaurant-"+e.id,r.innerHTML=e.name,t.appendChild(r)}};document.getElementById("form-submit-review").addEventListener("submit",function(e){e.preventDefault();var t=(new Date).getTime(),i={createdAt:t,updatedAt:t},r=!0,n=!1,a=void 0;try{for(var o,l=new FormData(this).entries()[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var u=o.value;i[u[0]]="restaurant_id"==u[0]||"rating"==u[0]?parseInt(u[1]):u[1]}}catch(e){n=!0,a=e}finally{try{!r&&l.return&&l.return()}finally{if(n)throw a}}this.reset(),dbHelper.submitReview(i,function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=_slicedToArray(e,2),r=t[0],n=void 0!==r&&r,a=t[1];n?document.getElementById("reviews-list").appendChild(createReviewHTML(i)):(console.error(a),confirm("The server or you are currently offline!\nWould you like to cache the review submission for a later?")&&(document.getElementById("reviews-list").appendChild(createReviewHTML(i)),dbHelper.cacheReviewSubmission(i),console.info("Cached Review",i)))})});var togglefavouriteRestaurant=function(){dbHelper.togglefavouriteRestaurant(restaurantId,this.checked)};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJuYW1lIiwidXJsIiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsInJlc3VsdHMiLCJyZWdleCIsIm1hcCIsInBhcnNlSW50IiwicmVzdGF1cmFudElkIiwic2VsZiIsImRiSGVscGVyIiwiaW5pdE1hcCIsIm9rIiwicmVzdGF1cmFudCIsImdvb2dsZSIsIm1hcHMiLCJNYXAiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiem9vbSIsInNjcm9sbHdoZWVsIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImNvbnNvbGUiLCJlcnJvciIsImZpbGxSZXN0YXVyYW50RXJyb3JIVE1MIiwiaW5uZXJIVE1MIiwicmVtb3ZlQ2hpbGQiLCJyZXZpZXdzQ29udGFpbmVyIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsImNhbGxiYWNrIiwiaXNOYU4iLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwicGljdHVyZV9jb250YWluZXIiLCJmYXZvdXJpdGVDaGVja2JveCIsImNoZWNrZWQiLCJpc19mYXZvcml0ZSIsInF1ZXJ5U2VsZWN0b3IiLCJhZGRyZXNzIiwic291cmNlX3NtYWxsIiwiY3JlYXRlRWxlbWVudCIsImltZ05hbWUiLCJpbWFnZU5hbWVGb3JSZXN0YXVyYW50Iiwic2V0QXR0cmlidXRlIiwic291cmNlX2xhcmdlIiwiaW1hZ2UiLCJhbHQiLCJzcmMiLCJjbGFzc05hbWUiLCJhcHBlbmQiLCJwcmVwZW5kIiwicGljdHVyZSIsImN1aXNpbmVfdHlwZSIsIm9wZXJhdGluZ19ob3VycyIsImZpbGxSZXN0YXVyYW50SG91cnNIVE1MIiwiYWRkRXZlbnRMaXN0ZW5lciIsInRvZ2dsZWZhdm91cml0ZVJlc3RhdXJhbnQiLCJzdWJtaXRDYWNoZWRSZXZpZXciLCJzdWJtaXRDYWNoZWRGYXZvdXJpdGVSZXN0YXVyYW50Iiwib3BlcmF0aW5nSG91cnMiLCJob3VycyIsImtleSIsInJvdyIsImRheSIsInRpbWUiLCJhcHBlbmRDaGlsZCIsImZpbGxSZXZpZXdzSFRNTCIsImZldGNoUmV2aWV3c0J5UmVzdGF1cmFudElkIiwiX3JlZiIsIl9yZWYyIiwiX3NsaWNlZFRvQXJyYXkiLCJfcmVmMiQiLCJyZXZpZXdzIiwidWwiLCJub1Jldmlld3MiLCJjb250YWluZXIiLCJpZCIsIkVycm9yIiwic29ydCIsImEiLCJiIiwiZm9yRWFjaCIsInJldmlldyIsImNyZWF0ZVJldmlld0hUTUwiLCJjcmVhdGVkQXQiLCJsaSIsImRhdGUiLCJ0b0xvY2FsZURhdGVTdHJpbmciLCJ0b0xvY2FsZVRpbWVTdHJpbmciLCJjb21tZW50cyIsInJhdGluZyIsInRpdGxlIiwicmVwZWF0IiwiZmlsbEJyZWFkY3J1bWIiLCJicmVhZGNydW1iIiwiZSIsInByZXZlbnREZWZhdWx0IiwiRGF0ZSIsIm5vdyIsInVwZGF0ZWRBdCIsIl9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24iLCJfZGlkSXRlcmF0b3JFcnJvciIsIl9pdGVyYXRvckVycm9yIiwiX3N0ZXAiLCJfaXRlcmF0b3IiLCJGb3JtRGF0YSIsInRoaXMiLCJlbnRyaWVzIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJuZXh0IiwiZG9uZSIsInBhaXIiLCJ2YWx1ZSIsImpzb24iLCJlcnIiLCJyZXR1cm4iLCJzdWJtaXRSZXZpZXciLCJfcmVmMyIsIl9yZWY0IiwiX3JlZjQkIiwibmV3UmV2aWV3IiwiY29uZmlybSIsImNhY2hlUmV2aWV3U3VibWlzc2lvbiIsImluZm8iXSwibWFwcGluZ3MiOiI0YUFLTUEsbUJBQXFCLFNBQUNDLEVBQU1DLEdBSGxDQSxJQUtJQSxFQUFNQyxPQUFPQyxTQUFTQyxNQUN4QkosRUFBT0EsRUFBS0ssUUFBUSxVQUFXLFFBSGpDLElBQ0VDLEVBRElQLElBQUFBLE9BQUFBLE9BQUFBLEVBQUFBLHFCQUVJRyxLQUFP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ZXN2ZXJzaW9uOiA2ICovXHJcblxyXG4vKipcclxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cclxuICovXHJcbmNvbnN0IGdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcclxuICBpZiAoIXVybClcclxuICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xyXG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcclxuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcclxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XHJcbiAgaWYgKCFyZXN1bHRzKVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgaWYgKCFyZXN1bHRzWzJdKVxyXG4gICAgcmV0dXJuICcnO1xyXG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XHJcbn07XHJcblxyXG5cclxubGV0IG1hcCwgcmVzdGF1cmFudElkID0gcGFyc2VJbnQoZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpKTtcclxuY29uc3QgZGJIZWxwZXIgPSBuZXcgREJIZWxwZXIoKTtcclxuc2VsZi5yZXZpZXdzID0gW107XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgob2ssIHJlc3RhdXJhbnQpID0+IHtcclxuXHJcbiAgICBpZiAoIW9rKSB7IC8vIEdvdCBhbiBlcnJvciFcclxuICAgICAgY29uc29sZS5lcnJvcihyZXN0YXVyYW50KTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgICAgIHpvb206IDE2LFxyXG4gICAgICAgIGNlbnRlcjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgICAgIH0pO1xyXG4gICAgICBmaWxsQnJlYWRjcnVtYigpO1xyXG4gICAgICBkYkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEVycm9yIEhUTUwgaWYgbm9uZSBpcyBmb3VuZCBhbmQgYWRkcyBpdCB0byB0aGUgd2VicGFnZVxyXG4gKi9cclxuY29uc3QgZmlsbFJlc3RhdXJhbnRFcnJvckhUTUwgPSAoKSA9PiB7XHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpLmlubmVySFRNTCA9ICdObyByZXN0YXVyYW50IGZvdW5kISc7XHJcbiAgdmFyIHJldmlld3NDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJldmlld3MtY29udGFpbmVyXCIpO1xyXG4gIHJldmlld3NDb250YWluZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyZXZpZXdzQ29udGFpbmVyKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXHJcbiAqL1xyXG5jb25zdCBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMID0gKGNhbGxiYWNrKSA9PiB7XHJcbiAgLyppZiAoc2VsZi5yZXN0YXVyYW50KSB7IC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxyXG4gICAgY2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KTtcclxuICAgIHJldHVybjtcclxuICB9Ki9cclxuICBpZiAoIXJlc3RhdXJhbnRJZCB8fCBpc05hTihyZXN0YXVyYW50SWQpKSB7IC8vIG5vIGlkIGZvdW5kIGluIFVSTFxyXG4gICAgZmlsbFJlc3RhdXJhbnRFcnJvckhUTUwoKTtcclxuICB9IGVsc2Uge1xyXG5cclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50X2lkJykudmFsdWUgPSByZXN0YXVyYW50SWQ7XHJcblxyXG4gICAgZGJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChyZXN0YXVyYW50SWQsIChvaywgcmVzdGF1cmFudCkgPT4ge1xyXG4gICAgICAvL0NhY2hlIHdhcyBjb3JyZWN0bHkgaGl0IGJ1dCBub3RoaW5nIGluIHRoZXJlXHJcbiAgICAgIGlmIChvayAmJiAhcmVzdGF1cmFudCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICAvL0FuIGVycm9yIG9jY3VyZWQgYW5kIHdlIGRvbid0IGhhdmUgYSByZXN0YXVyYW50IHlldCAoZnJvbSBjYWNoZSlcclxuICAgICAgZWxzZSBpZiAoKCFvayAvKnx8IHJlc3RhdXJhbnQgaW5zdGFuY2VvZiBFcnJvciovICkgJiYgIXNlbGYucmVzdGF1cmFudCkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IocmVzdGF1cmFudCk7XHJcbiAgICAgICAgZmlsbFJlc3RhdXJhbnRFcnJvckhUTUwoKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vUmVzdHJhdXJhbnQgd2FzIGNvcnJlY3RseSBmZXRjaGVkIGVpdGhlciBmcm9tIGNhY2hlIG9yIHNlcnZlclxyXG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xyXG4gICAgICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcclxuICAgICAgY2FsbGJhY2sodHJ1ZSwgcmVzdGF1cmFudCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn07XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlXHJcbiAqL1xyXG5jb25zdCBmaWxsUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xyXG5cclxuICBjb25zdCBwaWN0dXJlX2NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LXBpYy1jb250YWluZXInKTtcclxuICBsZXQgZmF2b3VyaXRlQ2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmF2b3VyaXRlLXJlc3RhdXJhbnQnKTtcclxuICAvL09PVEIgcmVzdGF1cmFudCBnb3QgdGhlIHZhbHVlIHNhdmVkIGFzIGJvb2xlYW5zLCBuZXdseSBhZGRlZCBvbmVzIGFzIHN0cmluZyA6LS9cclxuICBmYXZvdXJpdGVDaGVja2JveC5jaGVja2VkID0gKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09ICd0cnVlJyB8fCAodHlwZW9mKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUpID09PSBcImJvb2xlYW5cIiAmJiByZXN0YXVyYW50LmlzX2Zhdm9yaXRlKSk7XHJcblxyXG4gIGlmIChwaWN0dXJlX2NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdwaWN0dXJlJykgPT09IG51bGwpIHtcclxuXHJcbiAgICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xyXG4gICAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcblxyXG4gICAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcclxuICAgIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG5cclxuICAgIGNvbnN0IGltZ05hbWUgPSBkYkhlbHBlci5pbWFnZU5hbWVGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG5cclxuICAgIGNvbnN0IHBpY3R1cmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwaWN0dXJlJyk7XHJcblxyXG4gICAgY29uc3Qgc291cmNlX3NtYWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XHJcbiAgICBzb3VyY2Vfc21hbGwuc2V0QXR0cmlidXRlKCdtZWRpYScsICcobWF4LXdpZHRoOjc1MHB4KScpO1xyXG4gICAgc291cmNlX3NtYWxsLnNldEF0dHJpYnV0ZSgnc3Jjc2V0JywgYC9pbWcvJHtpbWdOYW1lfS02NTAud2VicCAxeCwgL2ltZy8ke2ltZ05hbWV9LTgwMC53ZWJwIDJ4YCk7XHJcblxyXG4gICAgY29uc3Qgc291cmNlX2xhcmdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XHJcbiAgICBzb3VyY2VfbGFyZ2Uuc2V0QXR0cmlidXRlKCdtZWRpYScsICcobWF4LXdpZHRoOjEyMDBweCknKTtcclxuICAgIHNvdXJjZV9sYXJnZS5zZXRBdHRyaWJ1dGUoJ3NyY3NldCcsIGAvaW1nLyR7aW1nTmFtZX0tNTUwLndlYnAgMXgsIC9pbWcvJHtpbWdOYW1lfS04MDAud2VicCAyeGApO1xyXG5cclxuICAgIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XHJcbiAgICBpbWFnZS5zcmMgPSBgL2ltZy8ke2ltZ05hbWV9LTgwMC53ZWJwYDtcclxuICAgIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XHJcbiAgICBpbWFnZS5pZCA9ICdyZXN0YXVyYW50LWltZyc7XHJcbiAgICBpbWFnZS5hbHQgPSByZXN0YXVyYW50Lm5hbWU7XHJcblxyXG4gICAgcGljdHVyZS5hcHBlbmQoc291cmNlX3NtYWxsKTtcclxuICAgIHBpY3R1cmUuYXBwZW5kKHNvdXJjZV9sYXJnZSk7XHJcbiAgICBwaWN0dXJlLmFwcGVuZChpbWFnZSk7XHJcblxyXG4gICAgcGljdHVyZV9jb250YWluZXIucHJlcGVuZChwaWN0dXJlKTtcclxuXHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwLWNvbnRhaW5lcicpLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGBHb29nbGUgTWFwcyBzaG93aW5nICR7cmVzdGF1cmFudC5uYW1lfSdzIGxvY2F0aW9uYCk7XHJcblxyXG4gICAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcclxuICAgIGN1aXNpbmUuaW5uZXJIVE1MID0gYCR7cmVzdGF1cmFudC5jdWlzaW5lX3R5cGV9IFJlc3RhdXJhbnRgO1xyXG5cclxuICAgIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXHJcbiAgICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcclxuICAgICAgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcclxuICAgIH1cclxuXHJcbiAgICBmYXZvdXJpdGVDaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB0b2dnbGVmYXZvdXJpdGVSZXN0YXVyYW50KTtcclxuXHJcbiAgICAvLyBmaWxsIHJldmlld3NcclxuICAgIGRiSGVscGVyLnN1Ym1pdENhY2hlZFJldmlldyhyZXN0YXVyYW50SWQpO1xyXG4gICAgZGJIZWxwZXIuc3VibWl0Q2FjaGVkRmF2b3VyaXRlUmVzdGF1cmFudChyZXN0YXVyYW50SWQpO1xyXG4gICAgZmlsbFJldmlld3NIVE1MKCk7XHJcbiAgfVxyXG5cclxufTtcclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuY29uc3QgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSA9PiB7XHJcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xyXG4gIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xyXG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcclxuXHJcbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgZGF5LmlubmVySFRNTCA9IGtleTtcclxuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xyXG5cclxuICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xyXG4gICAgcm93LmFwcGVuZENoaWxkKHRpbWUpO1xyXG5cclxuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmNvbnN0IGZpbGxSZXZpZXdzSFRNTCA9ICgpID0+IHtcclxuXHJcbiAgICBkYkhlbHBlci5mZXRjaFJldmlld3NCeVJlc3RhdXJhbnRJZChyZXN0YXVyYW50SWQsIChbb2sgPSBmYWxzZSwgcmV2aWV3c10pID0+IHtcclxuXHJcbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpO1xyXG4gICAgICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcclxuXHJcbiAgICAgIGlmIChvayAmJiAhcmV2aWV3cykge1xyXG5cclxuICAgICAgICB1bC5pbm5lckhUTUwgPSAnJztcclxuICAgICAgICBjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG4gICAgICAgIG5vUmV2aWV3cy5pZCA9ICduby1yZXZpZXdzLXlldCc7XHJcbiAgICAgICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldC4gQmUgdGhlIGZpcnN0IG9uZSEnO1xyXG4gICAgICAgIHVsLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgfSBlbHNlIGlmICghb2sgfHwgcmV2aWV3cyBpbnN0YW5jZW9mIEVycm9yKSB7XHJcblxyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IocmV2aWV3cyk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgfVxyXG5cclxuICAgICAgLy9NYWtlIHN1cmUgdGhlIHJldmlld3MgYXJlIHNvcnRlZCBkZXNjZW5kaW5nIGJ5IGNyZWF0ZWRBdCBkYXRlXHJcbiAgICAgIHJldmlld3Muc29ydChmdW5jdGlvbihhLCBiKXtcclxuICAgICAgICByZXR1cm4gYS5jcmVhdGVkQXQgLSBiLmNyZWF0ZWRBdDtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICB1bC5pbm5lckhUTUwgPSAnJztcclxuICAgICAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XHJcbiAgICAgICAgICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgc2VsZi5yZXZpZXdzID0gcmV2aWV3cztcclxuXHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmNvbnN0IGNyZWF0ZVJldmlld0hUTUwgPSAocmV2aWV3KSA9PiB7XHJcblxyXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICBsaS5pZCA9IGByZXZpZXctJHtyZXZpZXcuaWR9YDtcclxuXHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gIG5hbWUuY2xhc3NOYW1lID0gJ3Jldmlld3MtYXV0aG9yJztcclxuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xyXG4gIGxpLmFwcGVuZENoaWxkKG5hbWUpO1xyXG5cclxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc21hbGwnKTtcclxuICBkYXRlLmNsYXNzTmFtZSA9ICdyZXZpZXdzLWRhdGUnO1xyXG4gIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKHJldmlldy5jcmVhdGVkQXQpO1xyXG4gIGRhdGUuaW5uZXJIVE1MID0gYCR7Y3JlYXRlZEF0LnRvTG9jYWxlRGF0ZVN0cmluZygpfSAtICR7Y3JlYXRlZEF0LnRvTG9jYWxlVGltZVN0cmluZygpfWA7XHJcbiAgbmFtZS5hcHBlbmRDaGlsZChkYXRlKTtcclxuXHJcbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xyXG4gIGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcclxuXHJcbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gIHJhdGluZy5jbGFzc05hbWUgPSAncmV2aWV3cy1yYXRpbmcnO1xyXG4gIHJhdGluZy50aXRsZSA9IGBSYXRpbmc6ICR7cmV2aWV3LnJhdGluZ31gO1xyXG4gIHJhdGluZy5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCByYXRpbmcudGl0bGUpO1xyXG4gIHJhdGluZy5pbm5lckhUTUwgPSAnJiM5NzMzOycucmVwZWF0KHBhcnNlSW50KHJldmlldy5yYXRpbmcpKSArICcmIzk3MzQ7Jy5yZXBlYXQoNSAtIHBhcnNlSW50KHJldmlldy5yYXRpbmcpKTsgLy9zdGFyIChwYXN0aW5nIHRoZSBzeW1ib2wgYXMgc3RyaW5nIGl0c2VsZiBkaWRuJ3Qgd29yaylcclxuICBsaS5hcHBlbmRDaGlsZChyYXRpbmcpO1xyXG5cclxuICByZXR1cm4gbGk7XHJcbn07XHJcblxyXG4vKipcclxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcclxuICovXHJcbmNvbnN0IGZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcclxuXHJcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XHJcbiAgaWYgKGJyZWFkY3J1bWIucXVlcnlTZWxlY3RvcihgI2NydW1iLXJlc3RhdXJhbnQtJHtyZXN0YXVyYW50SWR9YCkgPT09IG51bGwpIHtcclxuICAgIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICAgIGxpLmlkID0gYGNydW1iLXJlc3RhdXJhbnQtJHtyZXN0YXVyYW50LmlkfWA7XHJcbiAgICBsaS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcclxuICB9XHJcbn07XHJcblxyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9ybS1zdWJtaXQtcmV2aWV3JykuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZnVuY3Rpb24oZSkge1xyXG5cclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gIGxldCBqc29uID0ge1xyXG4gICAgY3JlYXRlZEF0OiBub3csXHJcbiAgICB1cGRhdGVkQXQ6IG5vd1xyXG4gIH07XHJcblxyXG4gIGZvciAoY29uc3QgcGFpciBvZiBuZXcgRm9ybURhdGEodGhpcykuZW50cmllcygpKSB7XHJcbiAgICAvL1BhcnNlIHJlc3RhdXJhbnRfaWQgYW5kIHJhdGluZyBhcyBJbnRlZ2VyXHJcbiAgICBqc29uW3BhaXJbMF1dID0gKHBhaXJbMF0gPT0gJ3Jlc3RhdXJhbnRfaWQnIHx8IHBhaXJbMF0gPT0gJ3JhdGluZycpID8gcGFyc2VJbnQocGFpclsxXSkgOiBwYWlyWzFdO1xyXG4gIH1cclxuXHJcbiAgdGhpcy5yZXNldCgpO1xyXG5cclxuICBkYkhlbHBlci5zdWJtaXRSZXZpZXcoanNvbiwgKFtvayA9IGZhbHNlLCBuZXdSZXZpZXddID0gW10pID0+IHtcclxuXHJcblxyXG4gICAgaWYoIW9rKXtcclxuICAgICAgICBjb25zb2xlLmVycm9yKG5ld1Jldmlldyk7XHJcblxyXG4gICAgICAgIGlmKGNvbmZpcm0oXCJUaGUgc2VydmVyIG9yIHlvdSBhcmUgY3VycmVudGx5IG9mZmxpbmUhXFxuV291bGQgeW91IGxpa2UgdG8gY2FjaGUgdGhlIHJldmlldyBzdWJtaXNzaW9uIGZvciBhIGxhdGVyP1wiKSl7XHJcblxyXG4gICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwoanNvbikpO1xyXG4gICAgICAgICAgZGJIZWxwZXIuY2FjaGVSZXZpZXdTdWJtaXNzaW9uKGpzb24pO1xyXG4gICAgICAgICAgY29uc29sZS5pbmZvKCdDYWNoZWQgUmV2aWV3JywganNvbik7XHJcbiAgICAgICAgfVxyXG4gICAgfWVsc2V7XHJcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKS5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKGpzb24pKTtcclxuICAgIH1cclxuXHJcbiAgfSk7XHJcblxyXG59KTtcclxuXHJcbmNvbnN0IHRvZ2dsZWZhdm91cml0ZVJlc3RhdXJhbnQgPSBmdW5jdGlvbigpe1xyXG4gICAgZGJIZWxwZXIudG9nZ2xlZmF2b3VyaXRlUmVzdGF1cmFudChyZXN0YXVyYW50SWQsIHRoaXMuY2hlY2tlZCk7XHJcbn07XHJcbiJdfQ==
