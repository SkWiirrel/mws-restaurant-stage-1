"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null},map=void 0,restaurantId=parseInt(getParameterByName("id")),dbHelper=new DBHelper;self.reviews=[],window.initMap=function(){fetchRestaurantFromURL(function(e,t){e?(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),dbHelper.mapMarkerForRestaurant(self.restaurant,self.map)):console.error(t)})};var fillRestaurantErrorHTML=function(){document.getElementById("restaurant-name").innerHTML="No restaurant found!";var e=document.getElementById("reviews-container");e.parentNode.removeChild(e)},fetchRestaurantFromURL=function(r){!restaurantId||isNaN(restaurantId)?fillRestaurantErrorHTML():(document.getElementById("restaurant_id").value=restaurantId,dbHelper.fetchRestaurantById(restaurantId,function(e,t){if(!e||t){if(!e&&!self.restaurant)return console.error(t),void fillRestaurantErrorHTML();self.restaurant=t,fillRestaurantHTML(),r(!0,t)}}))},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var t=dbHelper.imageNameForRestaurant(e),r=document.getElementById("restaurant-pic-container");if(null===r.querySelector("picture")){var n=document.createElement("picture"),a=document.createElement("source");a.setAttribute("media","(max-width:750px)"),a.setAttribute("srcset","/img/"+t+"-650.webp 1x, /img/"+t+"-800.webp 2x");var i=document.createElement("source");i.setAttribute("media","(max-width:1200px)"),i.setAttribute("srcset","/img/"+t+"-550.webp 1x, /img/"+t+"-800.webp 2x");var o=document.createElement("img");o.src="/img/"+t+"-800.webp",o.className="restaurant-img",o.id="restaurant-img",o.alt=e.name,n.append(a),n.append(i),n.append(o),r.prepend(n),document.getElementById("map-container").setAttribute("aria-label","Google Maps showing "+e.name+"'s location"),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type+" Restaurant",e.operating_hours&&fillRestaurantHoursHTML(),dbHelper.submitCachedReview(restaurantId),fillReviewsHTML()}},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var r in e){var n=document.createElement("tr"),a=document.createElement("td");a.innerHTML=r,n.appendChild(a);var i=document.createElement("td");i.innerHTML=e[r],n.appendChild(i),t.appendChild(n)}},fillReviewsHTML=function(){dbHelper.fetchReviewsByRestaurantId(restaurantId,function(e){var t=_slicedToArray(e,2),r=t[0],n=void 0!==r&&r,a=t[1],i=(document.getElementById("reviews-container"),document.getElementById("reviews-list"));if(n&&!a){i.innerHTML="";var o=document.createElement("li");return o.id="no-reviews-yet",o.innerHTML="No reviews yet. Be the first one!",void i.appendChild(o)}!n||a instanceof Error?console.error(a):(a.sort(function(e,t){return e.createdAt-t.createdAt}),i.innerHTML="",a.forEach(function(e){i.appendChild(createReviewHTML(e))}),self.reviews=a)})},createReviewHTML=function(e){var t=document.createElement("li");t.id="review-"+e.id;var r=document.createElement("div");r.className="reviews-author",r.innerHTML=e.name,t.appendChild(r);var n=document.createElement("small");n.className="reviews-date";var a=new Date(e.createdAt);n.innerHTML=a.toLocaleDateString()+" - "+a.toLocaleTimeString(),r.appendChild(n);var i=document.createElement("p");i.innerHTML=e.comments,t.appendChild(i);var o=document.createElement("span");return o.className="reviews-rating",o.title="Rating: "+e.rating,o.setAttribute("aria-label",o.title),o.innerHTML="&#9733;".repeat(parseInt(e.rating))+"&#9734;".repeat(5-parseInt(e.rating)),t.appendChild(o),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb");if(null===t.querySelector("#crumb-restaurant-"+e.id)){var r=document.createElement("li");r.id="crumb-restaurant-"+e.id,r.innerHTML=e.name,t.appendChild(r)}};document.getElementById("form-submit-review").addEventListener("submit",function(e){e.preventDefault();var t=(new Date).getTime(),i={createdAt:t,updatedAt:t},r=!0,n=!1,a=void 0;try{for(var o,l=new FormData(this).entries()[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var d=o.value;i[d[0]]="restaurant_id"==d[0]||"rating"==d[0]?parseInt(d[1]):d[1]}}catch(e){n=!0,a=e}finally{try{!r&&l.return&&l.return()}finally{if(n)throw a}}this.reset(),dbHelper.submitReview(i,function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=_slicedToArray(e,2),r=t[0],n=void 0!==r&&r,a=t[1];n||(dbHelper.cacheReviewSubmission(i),console.info("Cached Review",i),console.error(a)),document.getElementById("reviews-list").appendChild(createReviewHTML(i))})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJuYW1lIiwidXJsIiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsInJlc3VsdHMiLCJyZWdleCIsIm1hcCIsInBhcnNlSW50IiwicmVzdGF1cmFudElkIiwic2VsZiIsImRiSGVscGVyIiwiaW5pdE1hcCIsIm9rIiwicmVzdGF1cmFudCIsImdvb2dsZSIsIm1hcHMiLCJNYXAiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiem9vbSIsInNjcm9sbHdoZWVsIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImNvbnNvbGUiLCJlcnJvciIsImZpbGxSZXN0YXVyYW50RXJyb3JIVE1MIiwiaW5uZXJIVE1MIiwicmVtb3ZlQ2hpbGQiLCJyZXZpZXdzQ29udGFpbmVyIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsImNhbGxiYWNrIiwiaXNOYU4iLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwiYWRkcmVzcyIsImltZ05hbWUiLCJpbWFnZU5hbWVGb3JSZXN0YXVyYW50IiwicGljdHVyZV9jb250YWluZXIiLCJzb3VyY2Vfc21hbGwiLCJxdWVyeVNlbGVjdG9yIiwic2V0QXR0cmlidXRlIiwic291cmNlX2xhcmdlIiwiY3JlYXRlRWxlbWVudCIsImltYWdlIiwiYWx0Iiwic3JjIiwiY2xhc3NOYW1lIiwiYXBwZW5kIiwicHJlcGVuZCIsInBpY3R1cmUiLCJjdWlzaW5lX3R5cGUiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJyb3ciLCJkYXkiLCJ0aW1lIiwiYXBwZW5kQ2hpbGQiLCJmaWxsUmV2aWV3c0hUTUwiLCJmZXRjaFJldmlld3NCeVJlc3RhdXJhbnRJZCIsIl9yZWYiLCJfcmVmMiIsIl9zbGljZWRUb0FycmF5IiwiX3JlZjIkIiwicmV2aWV3cyIsInVsIiwibm9SZXZpZXdzIiwiY29udGFpbmVyIiwiaWQiLCJFcnJvciIsInNvcnQiLCJhIiwiYiIsImZvckVhY2giLCJyZXZpZXciLCJjcmVhdGVSZXZpZXdIVE1MIiwiY3JlYXRlZEF0IiwibGkiLCJkYXRlIiwidG9Mb2NhbGVEYXRlU3RyaW5nIiwidG9Mb2NhbGVUaW1lU3RyaW5nIiwiY29tbWVudHMiLCJyYXRpbmciLCJ0aXRsZSIsInJlcGVhdCIsImZpbGxCcmVhZGNydW1iIiwiYnJlYWRjcnVtYiIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJEYXRlIiwibm93IiwidXBkYXRlZEF0IiwiX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiIsIl9kaWRJdGVyYXRvckVycm9yIiwiX2l0ZXJhdG9yRXJyb3IiLCJfc3RlcCIsIl9pdGVyYXRvciIsIkZvcm1EYXRhIiwidGhpcyIsImVudHJpZXMiLCJTeW1ib2wiLCJpdGVyYXRvciIsIm5leHQiLCJkb25lIiwicGFpciIsInZhbHVlIiwianNvbiIsImVyciIsInJldHVybiIsInN1Ym1pdFJldmlldyIsIl9yZWYzIiwiX3JlZjQiLCJfcmVmNCQiLCJuZXdSZXZpZXciLCJjYWNoZVJldmlld1N1Ym1pc3Npb24iLCJpbmZvIl0sIm1hcHBpbmdzIjoiNGFBS01BLG1CQUFxQixTQUFDQyxFQUFNQyxHQUhsQ0EsSUFLSUEsRUFBTUMsT0FBT0MsU0FBU0MsTUFDeEJKLEVBQU9BLEVBQUtLLFFBQVEsVUFBVyxRQUhqQyxJQUNFQyxFQURJUCxJQUFBQSxPQUFBQSxPQUFBQSxFQUFBQSxxQkFFSUcsS0FBT0MsR0FDZkgsT0FBQUEsRUFFRU0sRUFBQUEsR0FHR0EsbUJBQ0hBLEVBQUEsR0FBQUQsUUFBQSxNQUFBLE1BSEdDLEdBRkNDLE1BVUpDLFNBQUFBLEVBQUFBLGFBQUpDLFNBQUFWLG1CQUFBLE9BQVNXLFNBQUFBLElBQWVELFNBQ3hCRSxLQUFN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QUFLLEdBQWtCdEcsU0FBU3NHLEVBQUssSUFBTUEsRUFBSyxJQXJCakcsTUFBQUcsR0FBQWQsR0FBQSxFQUFBQyxFQUFBYSxFQUFBLFFBQUEsS0FBQWYsR0FBQUksRUFBQVksUUFBQVosRUFBQVksU0FBQSxRQUFBLEdBQUFmLEVBQUEsTUFBQUMsR0FlRW5CLEtBQUFBLFFBRFN0RSxTQUFYd0csYUFBQUgsRUFBQSxXQUFBLElBQUFJLEVBQUEsRUFBQWxGLFVBQUFDLGFBQUFDLElBQUFGLFVBQUEsR0FBQUEsVUFBQSxHQUFBLEdBQUFtRixFQUFBbEQsZUFBQWlELEVBQUEsR0FBQUUsRUFBQUQsRUFBQSxHQUFBeEcsT0FBQXVCLElBQUFrRixHQUFBQSxFQUFBQyxFQUFBRixFQUFBLEdBTG1GeEcsSUFBQUYsU0FBQTZHLHNCQUFBUixHQUFBekYsUUFBQWtHLEtBQUEsZ0JBQUFULEdBc0I3RXpGLFFBQVFDLE1BQU0rRixJQVo2QnJHLFNBQXRDNEYsZUFBc0MsZ0JBQUFoRCxZQUFBa0IsaUJBQUFnQyIsImZpbGUiOiJyZXN0YXVyYW50X2luZm8uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKmpzaGludCBlc3ZlcnNpb246IDYgKi9cclxuXHJcbi8qKlxyXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxyXG4gKi9cclxuY29uc3QgZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xyXG4gIGlmICghdXJsKVxyXG4gICAgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XHJcbiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgJ1xcXFwkJicpO1xyXG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxyXG4gICAgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcclxuICBpZiAoIXJlc3VsdHMpXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICBpZiAoIXJlc3VsdHNbMl0pXHJcbiAgICByZXR1cm4gJyc7XHJcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcclxufTtcclxuXHJcblxyXG5sZXQgbWFwLCByZXN0YXVyYW50SWQgPSBwYXJzZUludChnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJykpO1xyXG5jb25zdCBkYkhlbHBlciA9IG5ldyBEQkhlbHBlcigpO1xyXG5zZWxmLnJldmlld3MgPSBbXTtcclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXHJcbiAqL1xyXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcclxuICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKChvaywgcmVzdGF1cmFudCkgPT4ge1xyXG5cclxuICAgIGlmICghb2spIHsgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKHJlc3RhdXJhbnQpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XHJcbiAgICAgICAgem9vbTogMTYsXHJcbiAgICAgICAgY2VudGVyOiByZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgICBzY3JvbGx3aGVlbDogZmFsc2VcclxuICAgICAgfSk7XHJcbiAgICAgIGZpbGxCcmVhZGNydW1iKCk7XHJcbiAgICAgIGRiSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm1hcCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgRXJyb3IgSFRNTCBpZiBub25lIGlzIGZvdW5kIGFuZCBhZGRzIGl0IHRvIHRoZSB3ZWJwYWdlXHJcbiAqL1xyXG5jb25zdCBmaWxsUmVzdGF1cmFudEVycm9ySFRNTCA9ICgpID0+IHtcclxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJykuaW5uZXJIVE1MID0gJ05vIHJlc3RhdXJhbnQgZm91bmQhJztcclxuICB2YXIgcmV2aWV3c0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmV2aWV3cy1jb250YWluZXJcIik7XHJcbiAgcmV2aWV3c0NvbnRhaW5lci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJldmlld3NDb250YWluZXIpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cclxuICovXHJcbmNvbnN0IGZldGNoUmVzdGF1cmFudEZyb21VUkwgPSAoY2FsbGJhY2spID0+IHtcclxuICAvKmlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXHJcbiAgICBjYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpO1xyXG4gICAgcmV0dXJuO1xyXG4gIH0qL1xyXG4gIGlmICghcmVzdGF1cmFudElkIHx8IGlzTmFOKHJlc3RhdXJhbnRJZCkpIHsgLy8gbm8gaWQgZm91bmQgaW4gVVJMXHJcbiAgICBmaWxsUmVzdGF1cmFudEVycm9ySFRNTCgpO1xyXG4gIH0gZWxzZSB7XHJcblxyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRfaWQnKS52YWx1ZSA9IHJlc3RhdXJhbnRJZDtcclxuXHJcbiAgICBkYkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUlkKHJlc3RhdXJhbnRJZCwgKG9rLCByZXN0YXVyYW50KSA9PiB7XHJcbiAgICAgIC8vQ2FjaGUgd2FzIGNvcnJlY3RseSBoaXQgYnV0IG5vdGhpbmcgaW4gdGhlcmVcclxuICAgICAgaWYgKG9rICYmICFyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIC8vQW4gZXJyb3Igb2NjdXJlZCBhbmQgd2UgZG9uJ3QgaGF2ZSBhIHJlc3RhdXJhbnQgeWV0IChmcm9tIGNhY2hlKVxyXG4gICAgICBlbHNlIGlmICgoIW9rIC8qfHwgcmVzdGF1cmFudCBpbnN0YW5jZW9mIEVycm9yKi8gKSAmJiAhc2VsZi5yZXN0YXVyYW50KSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihyZXN0YXVyYW50KTtcclxuICAgICAgICBmaWxsUmVzdGF1cmFudEVycm9ySFRNTCgpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy9SZXN0cmF1cmFudCB3YXMgY29ycmVjdGx5IGZldGNoZWQgZWl0aGVyIGZyb20gY2FjaGUgb3Igc2VydmVyXHJcbiAgICAgIHNlbGYucmVzdGF1cmFudCA9IHJlc3RhdXJhbnQ7XHJcbiAgICAgIGZpbGxSZXN0YXVyYW50SFRNTCgpO1xyXG4gICAgICBjYWxsYmFjayh0cnVlLCByZXN0YXVyYW50KTtcclxuICAgIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcclxuICovXHJcbmNvbnN0IGZpbGxSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XHJcblxyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcblxyXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XHJcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XHJcblxyXG4gIGNvbnN0IGltZ05hbWUgPSBkYkhlbHBlci5pbWFnZU5hbWVGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG5cclxuICBjb25zdCBwaWN0dXJlX2NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LXBpYy1jb250YWluZXInKTtcclxuICBpZiAocGljdHVyZV9jb250YWluZXIucXVlcnlTZWxlY3RvcigncGljdHVyZScpID09PSBudWxsKSB7XHJcblxyXG4gICAgY29uc3QgcGljdHVyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3BpY3R1cmUnKTtcclxuXHJcbiAgICBjb25zdCBzb3VyY2Vfc21hbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcclxuICAgIHNvdXJjZV9zbWFsbC5zZXRBdHRyaWJ1dGUoJ21lZGlhJywgJyhtYXgtd2lkdGg6NzUwcHgpJyk7XHJcbiAgICBzb3VyY2Vfc21hbGwuc2V0QXR0cmlidXRlKCdzcmNzZXQnLCBgL2ltZy8ke2ltZ05hbWV9LTY1MC53ZWJwIDF4LCAvaW1nLyR7aW1nTmFtZX0tODAwLndlYnAgMnhgKTtcclxuXHJcbiAgICBjb25zdCBzb3VyY2VfbGFyZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcclxuICAgIHNvdXJjZV9sYXJnZS5zZXRBdHRyaWJ1dGUoJ21lZGlhJywgJyhtYXgtd2lkdGg6MTIwMHB4KScpO1xyXG4gICAgc291cmNlX2xhcmdlLnNldEF0dHJpYnV0ZSgnc3Jjc2V0JywgYC9pbWcvJHtpbWdOYW1lfS01NTAud2VicCAxeCwgL2ltZy8ke2ltZ05hbWV9LTgwMC53ZWJwIDJ4YCk7XHJcblxyXG4gICAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgIGltYWdlLnNyYyA9IGAvaW1nLyR7aW1nTmFtZX0tODAwLndlYnBgO1xyXG4gICAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcclxuICAgIGltYWdlLmlkID0gJ3Jlc3RhdXJhbnQtaW1nJztcclxuICAgIGltYWdlLmFsdCA9IHJlc3RhdXJhbnQubmFtZTtcclxuXHJcbiAgICBwaWN0dXJlLmFwcGVuZChzb3VyY2Vfc21hbGwpO1xyXG4gICAgcGljdHVyZS5hcHBlbmQoc291cmNlX2xhcmdlKTtcclxuICAgIHBpY3R1cmUuYXBwZW5kKGltYWdlKTtcclxuXHJcbiAgICBwaWN0dXJlX2NvbnRhaW5lci5wcmVwZW5kKHBpY3R1cmUpO1xyXG5cclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAtY29udGFpbmVyJykuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgYEdvb2dsZSBNYXBzIHNob3dpbmcgJHtyZXN0YXVyYW50Lm5hbWV9J3MgbG9jYXRpb25gKTtcclxuXHJcbiAgICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xyXG4gICAgY3Vpc2luZS5pbm5lckhUTUwgPSBgJHtyZXN0YXVyYW50LmN1aXNpbmVfdHlwZX0gUmVzdGF1cmFudGA7XHJcblxyXG4gICAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcclxuICAgIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xyXG4gICAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGZpbGwgcmV2aWV3c1xyXG4gICAgZGJIZWxwZXIuc3VibWl0Q2FjaGVkUmV2aWV3KHJlc3RhdXJhbnRJZCk7XHJcbiAgICBmaWxsUmV2aWV3c0hUTUwoKTtcclxuICB9XHJcblxyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5jb25zdCBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IChvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpID0+IHtcclxuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XHJcbiAgZm9yIChsZXQga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XHJcbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xyXG5cclxuICAgIGNvbnN0IGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XHJcbiAgICBkYXkuaW5uZXJIVE1MID0ga2V5O1xyXG4gICAgcm93LmFwcGVuZENoaWxkKGRheSk7XHJcblxyXG4gICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XHJcbiAgICB0aW1lLmlubmVySFRNTCA9IG9wZXJhdGluZ0hvdXJzW2tleV07XHJcbiAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XHJcblxyXG4gICAgaG91cnMuYXBwZW5kQ2hpbGQocm93KTtcclxuICB9XHJcbn07XHJcblxyXG4vKipcclxuICogQ3JlYXRlIGFsbCByZXZpZXdzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuY29uc3QgZmlsbFJldmlld3NIVE1MID0gKCkgPT4ge1xyXG5cclxuICAgIGRiSGVscGVyLmZldGNoUmV2aWV3c0J5UmVzdGF1cmFudElkKHJlc3RhdXJhbnRJZCwgKFtvayA9IGZhbHNlLCByZXZpZXdzXSkgPT4ge1xyXG5cclxuICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XHJcbiAgICAgIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xyXG5cclxuICAgICAgaWYgKG9rICYmICFyZXZpZXdzKSB7XHJcblxyXG4gICAgICAgIHVsLmlubmVySFRNTCA9ICcnO1xyXG4gICAgICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgICAgICAgbm9SZXZpZXdzLmlkID0gJ25vLXJldmlld3MteWV0JztcclxuICAgICAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0LiBCZSB0aGUgZmlyc3Qgb25lISc7XHJcbiAgICAgICAgdWwuYXBwZW5kQ2hpbGQobm9SZXZpZXdzKTtcclxuICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICB9IGVsc2UgaWYgKCFvayB8fCByZXZpZXdzIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuXHJcbiAgICAgICAgY29uc29sZS5lcnJvcihyZXZpZXdzKTtcclxuICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICB9XHJcblxyXG4gICAgICAvL01ha2Ugc3VyZSB0aGUgcmV2aWV3cyBhcmUgc29ydGVkIGRlc2NlbmRpbmcgYnkgY3JlYXRlZEF0IGRhdGVcclxuICAgICAgcmV2aWV3cy5zb3J0KGZ1bmN0aW9uKGEsIGIpe1xyXG4gICAgICAgIHJldHVybiBhLmNyZWF0ZWRBdCAtIGIuY3JlYXRlZEF0O1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHVsLmlubmVySFRNTCA9ICcnO1xyXG4gICAgICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcclxuICAgICAgICAgICAgdWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBzZWxmLnJldmlld3MgPSByZXZpZXdzO1xyXG5cclxuICAgIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuY29uc3QgY3JlYXRlUmV2aWV3SFRNTCA9IChyZXZpZXcpID0+IHtcclxuXHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG4gIGxpLmlkID0gYHJldmlldy0ke3Jldmlldy5pZH1gO1xyXG5cclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgbmFtZS5jbGFzc05hbWUgPSAncmV2aWV3cy1hdXRob3InO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XHJcbiAgbGkuYXBwZW5kQ2hpbGQobmFtZSk7XHJcblxyXG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzbWFsbCcpO1xyXG4gIGRhdGUuY2xhc3NOYW1lID0gJ3Jldmlld3MtZGF0ZSc7XHJcbiAgY29uc3QgY3JlYXRlZEF0ID0gbmV3IERhdGUocmV2aWV3LmNyZWF0ZWRBdCk7XHJcbiAgZGF0ZS5pbm5lckhUTUwgPSBgJHtjcmVhdGVkQXQudG9Mb2NhbGVEYXRlU3RyaW5nKCl9IC0gJHtjcmVhdGVkQXQudG9Mb2NhbGVUaW1lU3RyaW5nKCl9YDtcclxuICBuYW1lLmFwcGVuZENoaWxkKGRhdGUpO1xyXG5cclxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XHJcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xyXG5cclxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgcmF0aW5nLmNsYXNzTmFtZSA9ICdyZXZpZXdzLXJhdGluZyc7XHJcbiAgcmF0aW5nLnRpdGxlID0gYFJhdGluZzogJHtyZXZpZXcucmF0aW5nfWA7XHJcbiAgcmF0aW5nLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHJhdGluZy50aXRsZSk7XHJcbiAgcmF0aW5nLmlubmVySFRNTCA9ICcmIzk3MzM7Jy5yZXBlYXQocGFyc2VJbnQocmV2aWV3LnJhdGluZykpICsgJyYjOTczNDsnLnJlcGVhdCg1IC0gcGFyc2VJbnQocmV2aWV3LnJhdGluZykpOyAvL3N0YXIgKHBhc3RpbmcgdGhlIHN5bWJvbCBhcyBzdHJpbmcgaXRzZWxmIGRpZG4ndCB3b3JrKVxyXG4gIGxpLmFwcGVuZENoaWxkKHJhdGluZyk7XHJcblxyXG4gIHJldHVybiBsaTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxyXG4gKi9cclxuY29uc3QgZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xyXG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xyXG4gIGlmIChicmVhZGNydW1iLnF1ZXJ5U2VsZWN0b3IoYCNjcnVtYi1yZXN0YXVyYW50LSR7cmVzdGF1cmFudC5pZH1gKSA9PT0gbnVsbCkge1xyXG4gICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG4gICAgbGkuaWQgPSBgY3J1bWItcmVzdGF1cmFudC0ke3Jlc3RhdXJhbnQuaWR9YDtcclxuICAgIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcclxuICAgIGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpO1xyXG4gIH1cclxufTtcclxuXHJcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb3JtLXN1Ym1pdC1yZXZpZXcnKS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBmdW5jdGlvbihlKSB7XHJcblxyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgbGV0IGpzb24gPSB7XHJcbiAgICBjcmVhdGVkQXQ6IG5vdyxcclxuICAgIHVwZGF0ZWRBdDogbm93XHJcbiAgfTtcclxuXHJcbiAgZm9yIChjb25zdCBwYWlyIG9mIG5ldyBGb3JtRGF0YSh0aGlzKS5lbnRyaWVzKCkpIHtcclxuICAgIC8vUGFyc2UgcmVzdGF1cmFudF9pZCBhbmQgcmF0aW5nIGFzIEludGVnZXJcclxuICAgIGpzb25bcGFpclswXV0gPSAocGFpclswXSA9PSAncmVzdGF1cmFudF9pZCcgfHwgcGFpclswXSA9PSAncmF0aW5nJykgPyBwYXJzZUludChwYWlyWzFdKSA6IHBhaXJbMV07XHJcbiAgfVxyXG5cclxuICB0aGlzLnJlc2V0KCk7XHJcblxyXG4gIGRiSGVscGVyLnN1Ym1pdFJldmlldyhqc29uLCAoW29rID0gZmFsc2UsIG5ld1Jldmlld10gPSBbXSkgPT4ge1xyXG5cclxuICAgIGlmKCFvayl7XHJcbiAgICAgICAgZGJIZWxwZXIuY2FjaGVSZXZpZXdTdWJtaXNzaW9uKGpzb24pO1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbygnQ2FjaGVkIFJldmlldycsIGpzb24pO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IobmV3UmV2aWV3KTtcclxuICAgIH1cclxuXHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0JykuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChqc29uKSk7XHJcbiAgfSk7XHJcblxyXG59KTtcclxuIl19
