"use strict";var restaurants=void 0,neighborhoods=void 0,cuisines=void 0,map=void 0,markers=[],dbHelper=new DBHelper,intersectionObservationCallback=function(e,r){e.filter(function(e){return e.isIntersecting}).forEach(function(e){var t=e.target.querySelectorAll("source[data-srcset]"),n=e.target.querySelector("img[data-src]");t.forEach(function(e){e.setAttribute("srcset",e.getAttribute("data-srcset")),e.removeAttribute("data-srcset")}),n.setAttribute("src",n.getAttribute("data-src")),n.removeAttribute("data-src"),r.unobserve(e.target)})},intersectionObserver=new IntersectionObserver(intersectionObservationCallback),fetchNeighborhoods=function(){dbHelper.fetchNeighborhoods(function(e,t){e?(self.neighborhoods=t,fillNeighborhoodsHTML()):console.error(t)})},fillNeighborhoodsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,n=document.getElementById("neighborhoods-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})},fetchCuisines=function(){dbHelper.fetchCuisines(function(e,t){e?(self.cuisines=t,fillCuisinesHTML()):console.error(t)})},fillCuisinesHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines,n=document.getElementById("cuisines-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})};window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),console.log("INITMAP")};var updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e[e.selectedIndex].value,r=t[t.selectedIndex].value;dbHelper.fetchRestaurantByCuisineAndNeighborhood(n,r,function(e,t){console.log(t),e?(resetRestaurants(t),fillRestaurantsHTML()):console.error(t)})},resetRestaurants=function(e){var t=document.getElementById("restaurants-list");t.querySelectorAll("picture").forEach(function(e){return intersectionObserver.unobserve(e)}),t.innerHTML="",self.markers&&self.markers.forEach(function(e){return e.setMap(null)}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list");e.forEach(function(e){t.append(createRestaurantHTML(e))}),addMarkersToMap()},createRestaurantHTML=function(e){var t=document.createElement("li"),n=e.photograph||5,r=document.createElement("figure"),a=document.createElement("picture"),o=document.createElement("source");o.setAttribute("media","(max-width:750px)"),o.setAttribute("data-srcset","/img/"+n+"-650.webp 1x, /img/"+n+"-800.webp 2x");var s=document.createElement("source");s.setAttribute("media","(max-width:1200px)"),s.setAttribute("data-srcset","/img/"+n+"-550.webp 1x, /img/"+n+"-800.webp 2x");var i=document.createElement("img");i.setAttribute("data-src","/img/"+n+"-800.webp"),i.className="restaurant-img",i.alt=e.name,a.append(o),a.append(s),a.append(i),r.append(a),intersectionObserver.observe(a);var c="true"===e.is_favorite||"boolean"==typeof e.is_favorite&&e.is_favorite,u=document.createElement("figcaption");u.innerHTML=e.cuisine_type+" Restaurant"+(c?'<span aria-label="Favourite Restaurant"> &#9733;</span>':""),r.append(u),t.append(r);var l=document.createElement("div");l.className="restaurant-info";var d=document.createElement("h3");d.innerHTML=e.name,l.append(d);var m=document.createElement("p");m.innerHTML=e.neighborhood,l.append(m);var p=document.createElement("p");p.innerHTML=e.address,l.append(p);var f=document.createElement("a");return f.innerHTML="View Details about "+e.name,f.href=dbHelper.urlForRestaurant(e),l.append(f),t.append(l),t},addMarkersToMap=function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=dbHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),self.markers.push(t)})};document.addEventListener("DOMContentLoaded",function(e){fetchNeighborhoods(),fetchCuisines(),updateRestaurants()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJtYXAiLCJEQkhlbHBlciIsImludGVyc2VjdGlvbk9ic2VydmF0aW9uQ2FsbGJhY2siLCJlbnRyaWVzIiwib2JzZXJ2ZXIiLCJmaWx0ZXIiLCJlbnRyeSIsImlzSW50ZXJzZWN0aW5nIiwiZm9yRWFjaCIsInNvdXJjZXMiLCJ0YXJnZXQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiaW1nIiwicXVlcnlTZWxlY3RvciIsInNvdXJjZSIsInNldEF0dHJpYnV0ZSIsImdldEF0dHJpYnV0ZSIsInJlbW92ZUF0dHJpYnV0ZSIsImludGVyc2VjdGlvbk9ic2VydmVyIiwiSW50ZXJzZWN0aW9uT2JzZXJ2ZXIiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJkYkhlbHBlciIsIm9rIiwic2VsZiIsImNvbnNvbGUiLCJlcnJvciIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsIm5laWdoYm9yaG9vZCIsIm9wdGlvbiIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNlbGVjdCIsImZldGNoQ3Vpc2luZXMiLCJmaWxsQ3Vpc2luZXNIVE1MIiwiZ2V0RWxlbWVudEJ5SWQiLCJjdWlzaW5lIiwidmFsdWUiLCJ3aW5kb3ciLCJpbml0TWFwIiwiZ29vZ2xlIiwibWFwcyIsIk1hcCIsImNlbnRlciIsImxhdCIsImxuZyIsImxvZyIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiY1NlbGVjdCIsIm5TZWxlY3QiLCJzZWxlY3RlZEluZGV4IiwicmVzZXRSZXN0YXVyYW50cyIsInVsIiwicGljdHVyZSIsInVub2JzZXJ2ZSIsIm1hcmtlcnMiLCJtIiwic2V0TWFwIiwicGljdHVyZXMiLCJyZXN0YXVyYW50IiwiYXBwZW5kIiwiY3JlYXRlUmVzdGF1cmFudEhUTUwiLCJmaWxsUmVzdGF1cmFudHNIVE1MIiwibGkiLCJwaG90b2dyYXBoIiwiZmlndXJlIiwiYWRkTWFya2Vyc1RvTWFwIiwic291cmNlX3NtYWxsIiwiaW1nTmFtZSIsInNvdXJjZV9sYXJnZSIsImltYWdlIiwiaXNGYXZvdXJpdGUiLCJpc19mYXZvcml0ZSIsImNsYXNzTmFtZSIsImN1aXNpbmVfdHlwZSIsImFsdCIsIm9ic2VydmUiLCJuYW1lIiwiaW5uZXJIVE1MIiwiaW5mbyIsImNhcHRpb24iLCJhZGRyZXNzIiwibW9yZSIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJldmVudCIsImFkZExpc3RlbmVyIiwibWFya2VyIiwiaHJlZiIsInVybCIsInB1c2giXSwibWFwcGluZ3MiOiJhQUFBLElBQUFBLGlCQUFBQSxFQUdFQyxtQkFBQUEsRUFERkMsY0FBQUEsRUFDRUQsU0FBQUEsRUFDQUMsUUFBQUEsR0FDRUMsU0FBSixJQUFBQyxTQU9NQyxnQ0FBa0MsU0FBQ0MsRUFBU0MsR0FBbERELEVBR0tFLE9BQU8sU0FBQUMsR0FBQSxPQUFTQSxFQUFNQyxpQkFEekJKLFFBQ0dFLFNBQUFBLEdBQ0FHLElBRkhDLEVBRVdILEVBQUFJLE9BQVNDLGlCQUFBLHVCQUdWQyxFQUFNTixFQUFNSSxPQUFPRyxjQUFjLGlCQUF2Q0osRUFBWUgsUUFBTUksU0FBQUEsR0FHaEJJLEVBQU9DLGFBQWEsU0FBVUQsRUFBT0UsYUFBYSxnQkFEcERQLEVBQVFELGdCQUFRLGlCQUFoQkksRUFBQUcsYUFBQSxNQUFBSCxFQUFBSSxhQUFBLGFBTUFKLEVBQUlLLGdCQUFnQixZQUFwQkwsRUFBSUssVUFBZ0JYLEVBQUFJLFdBZjFCUSxxQkFBQSxJQUFBQyxxQkFzQkVqQixpQ0FNSWtCLG1CQUFxQixXQUN6QkMsU0FBU0QsbUJBQW1CLFNBQUFFLEVBQUF4QixHQUNyQndCLEdBQUxDLEtBRU96QixjQUFBQSxFQUNMeUIseUJBSFNDLFFBQUFDLE1BQUEzQixNQVlUNEIsc0JBQXdCLFdBQXdDLElBQXZDNUIsRUFBdUMsRUFBQTZCLFVBQUFDLGFBQUFDLElBQUFGLFVBQUEsR0FBQUEsVUFBQSxHQUF2Qkos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QUFQMEIsS0FBQUgsTUFNMER4RCxTQUFuQ25DLGlCQUFtQyxtQkFBQSxTQUFBeUYsR0FlMURsRSxxQkFkQXZCLGdCQUNFb0QiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qanNoaW50IGVzdmVyc2lvbjogNiAqL1xyXG5cclxubGV0IHJlc3RhdXJhbnRzLFxyXG4gIG5laWdoYm9yaG9vZHMsXHJcbiAgY3Vpc2luZXM7XHJcbmxldCBtYXA7XHJcbmxldCBtYXJrZXJzID0gW107XHJcbmNvbnN0IGRiSGVscGVyID0gbmV3IERCSGVscGVyKCk7XHJcblxyXG4vKipcclxuICogT25seSBsb2FkIGltYWdlcyB3aGVuIHRoZXkgYmVjb21lIHZpc2libGUgaW4gdGhlIHZpZXdwb3J0XHJcbiAqL1xyXG5jb25zdCBpbnRlcnNlY3Rpb25PYnNlcnZhdGlvbkNhbGxiYWNrID0gKGVudHJpZXMsIG9ic2VydmVyKSA9PiB7XHJcblxyXG4gIGVudHJpZXNcclxuICAgIC5maWx0ZXIoZW50cnkgPT4gZW50cnkuaXNJbnRlcnNlY3RpbmcpXHJcbiAgICAuZm9yRWFjaChlbnRyeSA9PiB7XHJcblxyXG4gICAgICBjb25zdCBzb3VyY2VzID0gZW50cnkudGFyZ2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJ3NvdXJjZVtkYXRhLXNyY3NldF0nKTtcclxuICAgICAgY29uc3QgaW1nID0gZW50cnkudGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJ2ltZ1tkYXRhLXNyY10nKTtcclxuXHJcbiAgICAgIHNvdXJjZXMuZm9yRWFjaChzb3VyY2UgPT4ge1xyXG4gICAgICAgIHNvdXJjZS5zZXRBdHRyaWJ1dGUoJ3NyY3NldCcsIHNvdXJjZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtc3Jjc2V0JykpO1xyXG4gICAgICAgIHNvdXJjZS5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtc3Jjc2V0Jyk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaW1nLnNldEF0dHJpYnV0ZSgnc3JjJywgaW1nLmdldEF0dHJpYnV0ZSgnZGF0YS1zcmMnKSk7XHJcbiAgICAgIGltZy5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtc3JjJyk7XHJcblxyXG4gICAgICBvYnNlcnZlci51bm9ic2VydmUoZW50cnkudGFyZ2V0KTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuY29uc3QgaW50ZXJzZWN0aW9uT2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoXHJcbiAgaW50ZXJzZWN0aW9uT2JzZXJ2YXRpb25DYWxsYmFja1xyXG4pO1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmNvbnN0IGZldGNoTmVpZ2hib3Job29kcyA9ICgpID0+IHtcclxuICBkYkhlbHBlci5mZXRjaE5laWdoYm9yaG9vZHMoKG9rLCBuZWlnaGJvcmhvb2RzKSA9PiB7XHJcbiAgICBpZiAoIW9rKSB7IC8vIEdvdCBhbiBlcnJvclxyXG4gICAgICBjb25zb2xlLmVycm9yKG5laWdoYm9yaG9vZHMpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5uZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcztcclxuICAgICAgZmlsbE5laWdoYm9yaG9vZHNIVE1MKCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogU2V0IG5laWdoYm9yaG9vZHMgSFRNTC5cclxuICovXHJcbmNvbnN0IGZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcbiAgbmVpZ2hib3Job29kcy5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmNvbnN0IGZldGNoQ3Vpc2luZXMgPSAoKSA9PiB7XHJcbiAgZGJIZWxwZXIuZmV0Y2hDdWlzaW5lcygob2ssIGN1aXNpbmVzKSA9PiB7XHJcbiAgICBpZiAoIW9rKSB7IC8vIEdvdCBhbiBlcnJvciFcclxuICAgICAgY29uc29sZS5lcnJvcihjdWlzaW5lcyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLmN1aXNpbmVzID0gY3Vpc2luZXM7XHJcbiAgICAgIGZpbGxDdWlzaW5lc0hUTUwoKTtcclxuICAgIH1cclxuICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cclxuICovXHJcbmNvbnN0IGZpbGxDdWlzaW5lc0hUTUwgPSAoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG5cclxuICBjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcclxuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgbGV0IGxvYyA9IHtcclxuICAgIGxhdDogNDAuNzIyMjE2LFxyXG4gICAgbG5nOiAtNzMuOTg3NTAxXHJcbiAgfTtcclxuICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XHJcbiAgICB6b29tOiAxMixcclxuICAgIGNlbnRlcjogbG9jLFxyXG4gICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgfSk7XHJcbiAgY29uc29sZS5sb2coJ0lOSVRNQVAnKTtcclxuLy8gIHVwZGF0ZVJlc3RhdXJhbnRzKCk7XHJcbn07XHJcblxyXG4vKipcclxuICogVXBkYXRlIHBhZ2UgYW5kIG1hcCBmb3IgY3VycmVudCByZXN0YXVyYW50cy5cclxuICovXHJcbmNvbnN0IHVwZGF0ZVJlc3RhdXJhbnRzID0gKCkgPT4ge1xyXG4gIGNvbnN0IGNTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XHJcbiAgY29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xyXG5cclxuICBjb25zdCBjdWlzaW5lID0gY1NlbGVjdFtjU2VsZWN0LnNlbGVjdGVkSW5kZXhdLnZhbHVlO1xyXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3RbblNlbGVjdC5zZWxlY3RlZEluZGV4XS52YWx1ZTtcclxuXHJcbiAgZGJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgKG9rLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgY29uc29sZS5sb2cocmVzdGF1cmFudHMpO1xyXG4gICAgaWYgKCFvaykgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IocmVzdGF1cmFudHMpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVzZXRSZXN0YXVyYW50cyhyZXN0YXVyYW50cyk7XHJcbiAgICAgIGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcclxuICAgIH1cclxuICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXHJcbiAqL1xyXG5jb25zdCByZXNldFJlc3RhdXJhbnRzID0gKHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xyXG4gIC8vc2VsZi5yZXN0YXVyYW50cyA9IFtdO1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuXHJcbiAgY29uc3QgcGljdHVyZXMgPSB1bC5xdWVyeVNlbGVjdG9yQWxsKCdwaWN0dXJlJyk7XHJcbiAgcGljdHVyZXMuZm9yRWFjaChwaWN0dXJlID0+IGludGVyc2VjdGlvbk9ic2VydmVyLnVub2JzZXJ2ZShwaWN0dXJlKSk7XHJcbiAgdWwuaW5uZXJIVE1MID0gJyc7XHJcblxyXG4gIC8vIFJlbW92ZSBhbGwgbWFwIG1hcmtlcnNcclxuICBpZiAoc2VsZi5tYXJrZXJzKSB7XHJcbiAgICBzZWxmLm1hcmtlcnMuZm9yRWFjaChtID0+IG0uc2V0TWFwKG51bGwpKTtcclxuICB9XHJcbiAgc2VsZi5tYXJrZXJzID0gW107XHJcbiAgc2VsZi5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5jb25zdCBmaWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcclxuICB9KTtcclxuICBhZGRNYXJrZXJzVG9NYXAoKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxyXG4gKi9cclxuY29uc3QgY3JlYXRlUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCkgPT4ge1xyXG5cclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcblxyXG4gIGNvbnN0IGltZ05hbWUgPSByZXN0YXVyYW50LnBob3RvZ3JhcGggfHwgNTtcclxuXHJcbiAgY29uc3QgZmlndXJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZmlndXJlJyk7XHJcbiAgY29uc3QgcGljdHVyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3BpY3R1cmUnKTtcclxuXHJcbiAgY29uc3Qgc291cmNlX3NtYWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XHJcbiAgc291cmNlX3NtYWxsLnNldEF0dHJpYnV0ZSgnbWVkaWEnLCAnKG1heC13aWR0aDo3NTBweCknKTtcclxuICBzb3VyY2Vfc21hbGwuc2V0QXR0cmlidXRlKCdkYXRhLXNyY3NldCcsIGAvaW1nLyR7aW1nTmFtZX0tNjUwLndlYnAgMXgsIC9pbWcvJHtpbWdOYW1lfS04MDAud2VicCAyeGApO1xyXG5cclxuICBjb25zdCBzb3VyY2VfbGFyZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcclxuICBzb3VyY2VfbGFyZ2Uuc2V0QXR0cmlidXRlKCdtZWRpYScsICcobWF4LXdpZHRoOjEyMDBweCknKTtcclxuICBzb3VyY2VfbGFyZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNyY3NldCcsIGAvaW1nLyR7aW1nTmFtZX0tNTUwLndlYnAgMXgsIC9pbWcvJHtpbWdOYW1lfS04MDAud2VicCAyeGApO1xyXG5cclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xyXG4gIGltYWdlLnNldEF0dHJpYnV0ZSgnZGF0YS1zcmMnLCBgL2ltZy8ke2ltZ05hbWV9LTgwMC53ZWJwYCk7XHJcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcclxuICBpbWFnZS5hbHQgPSByZXN0YXVyYW50Lm5hbWU7XHJcblxyXG4gIHBpY3R1cmUuYXBwZW5kKHNvdXJjZV9zbWFsbCk7XHJcbiAgcGljdHVyZS5hcHBlbmQoc291cmNlX2xhcmdlKTtcclxuICBwaWN0dXJlLmFwcGVuZChpbWFnZSk7XHJcbiAgZmlndXJlLmFwcGVuZChwaWN0dXJlKTtcclxuXHJcbiAgaW50ZXJzZWN0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShwaWN0dXJlKTtcclxuXHJcbiAgY29uc3QgaXNGYXZvdXJpdGUgPSAocmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gJ3RydWUnIHx8ICh0eXBlb2YocmVzdGF1cmFudC5pc19mYXZvcml0ZSkgPT09IFwiYm9vbGVhblwiICYmIHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUpKTtcclxuXHJcbiAgY29uc3QgY2FwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ZpZ2NhcHRpb24nKTtcclxuICBjYXB0aW9uLmlubmVySFRNTCA9IGAke3Jlc3RhdXJhbnQuY3Vpc2luZV90eXBlfSBSZXN0YXVyYW50YCArICgoaXNGYXZvdXJpdGUpID8gJzxzcGFuIGFyaWEtbGFiZWw9XCJGYXZvdXJpdGUgUmVzdGF1cmFudFwiPiAmIzk3MzM7PC9zcGFuPicgOiAnJyk7XHJcbiAgZmlndXJlLmFwcGVuZChjYXB0aW9uKTtcclxuXHJcbiAgbGkuYXBwZW5kKGZpZ3VyZSk7XHJcblxyXG4gIGNvbnN0IGluZm8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICBpbmZvLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWluZm8nO1xyXG5cclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDMnKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcclxuICBpbmZvLmFwcGVuZChuYW1lKTtcclxuXHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcclxuICBpbmZvLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG4gIGluZm8uYXBwZW5kKGFkZHJlc3MpO1xyXG5cclxuICBjb25zdCBtb3JlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gIG1vcmUuaW5uZXJIVE1MID0gYFZpZXcgRGV0YWlscyBhYm91dCAke3Jlc3RhdXJhbnQubmFtZX1gO1xyXG4gIG1vcmUuaHJlZiA9IGRiSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgaW5mby5hcHBlbmQobW9yZSk7XHJcblxyXG4gIGxpLmFwcGVuZChpbmZvKTtcclxuXHJcbiAgcmV0dXJuIGxpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEFkZCBtYXJrZXJzIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzIHRvIHRoZSBtYXAuXHJcbiAqL1xyXG5jb25zdCBhZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxyXG4gICAgY29uc3QgbWFya2VyID0gZGJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm1hcCk7XHJcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsO1xyXG4gICAgfSk7XHJcbiAgICBzZWxmLm1hcmtlcnMucHVzaChtYXJrZXIpO1xyXG4gIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxyXG4gKi9cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xyXG4gIGZldGNoTmVpZ2hib3Job29kcygpO1xyXG4gIGZldGNoQ3Vpc2luZXMoKTtcclxuICB1cGRhdGVSZXN0YXVyYW50cygpO1xyXG59KTtcclxuIl19
