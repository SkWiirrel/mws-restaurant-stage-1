"use strict";var _createClass=function(){function t(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var ServiceWorkerController=function(){function e(){_classCallCheck(this,e),this._registerServiceWorker()}return _createClass(e,[{key:"_registerServiceWorker",value:function(){navigator.serviceWorker&&navigator.serviceWorker.register("sw.js")}}]),e}();new ServiceWorkerController;
"use strict";!function(){function u(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function i(n,o,r){var i,e=new Promise(function(e,t){u(i=n[o].apply(n,r)).then(e,t)});return e.request=i,e}function e(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function t(t,n,o,e){e.forEach(function(e){e in o.prototype&&(t.prototype[e]=function(){return i(this[n],e,arguments)})})}function n(t,n,o,e){e.forEach(function(e){e in o.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function o(e,o,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[o],(t=i(e,n,arguments)).then(function(e){if(e)return new c(e,t.request)});var e,t})})}function r(e){this._index=e}function c(e,t){this._cursor=e,this._request=t}function s(e){this._store=e}function a(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function p(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new a(n)}function f(e){this._db=e}e(r,"_index",["name","keyPath","multiEntry","unique"]),t(r,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),o(r,"_index",IDBIndex,["openCursor","openKeyCursor"]),e(c,"_cursor",["direction","key","primaryKey","value"]),t(c,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(c.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),u(t._request).then(function(e){if(e)return new c(e,t._request)})})})}),s.prototype.createIndex=function(){return new r(this._store.createIndex.apply(this._store,arguments))},s.prototype.index=function(){return new r(this._store.index.apply(this._store,arguments))},e(s,"_store",["name","keyPath","indexNames","autoIncrement"]),t(s,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),o(s,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(s,"_store",IDBObjectStore,["deleteIndex"]),a.prototype.objectStore=function(){return new s(this._tx.objectStore.apply(this._tx,arguments))},e(a,"_tx",["objectStoreNames","mode"]),n(a,"_tx",IDBTransaction,["abort"]),p.prototype.createObjectStore=function(){return new s(this._db.createObjectStore.apply(this._db,arguments))},e(p,"_db",["name","version","objectStoreNames"]),n(p,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new a(this._db.transaction.apply(this._db,arguments))},e(f,"_db",["name","version","objectStoreNames"]),n(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(i){[s,r].forEach(function(e){e.prototype[i.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],o=this._store||this._index,r=o[i].apply(o,t.slice(0,-1));r.onsuccess=function(){n(r.result)}}})}),[r,s].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var o=this,r=[];return new Promise(function(t){o.iterateCursor(e,function(e){e?(r.push(e.value),void 0===n||r.length!=n?e.continue():t(r)):t(r)})})})});var d={open:function(e,t,n){var o=i(indexedDB,"open",[e,t]),r=o.request;return r.onupgradeneeded=function(e){n&&n(new p(r.result,e.oldVersion,r.transaction))},o.then(function(e){return new f(e)})},delete:function(e){return i(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=d,module.exports.default=module.exports):self.idb=d}();
"use strict";var _slicedToArray=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,i=!1,a=void 0;try{for(var o,u=t[Symbol.iterator]();!(n=(o=u.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{!n&&u.return&&u.return()}finally{if(i)throw a}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function t(){_classCallCheck(this,t),this.dbPromise=idb.open("restaurant-reviews",1,function(t){t.createObjectStore("restaurants",{keyPath:"id"}),t.createObjectStore("reviews",{keyPath:"id"}).createIndex("restaurant_id","restaurant_id"),t.createObjectStore("reviews-to-submit",{keyPath:"cache_id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id"),t.createObjectStore("favourite-to-submit",{keyPath:"restaurant_id"})})}return _createClass(t,[{key:"fetchRestaurants",value:function(e){var r=this;this.dbPromise.then(function(t){return t.transaction("restaurants").objectStore("restaurants").getAll()}).then(function(t){e([!0,t]),fetch(r.DATABASE_URL+"restaurants").then(function(t){return t.json()}).then(function(c){e([!0,c]),r.dbPromise.then(function(t){var e=t.transaction("restaurants","readwrite"),r=e.objectStore("restaurants"),n=!0,i=!1,a=void 0;try{for(var o,u=c[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;r.put(s)}}catch(t){i=!0,a=t}finally{try{!n&&u.return&&u.return()}finally{if(i)throw a}}return e.complete})}).catch(function(t){return e([!1,t])})})}},{key:"fetchRestaurant",value:function(e,r){var n=this;this.dbPromise.then(function(t){return t.transaction("restaurants").objectStore("restaurants").get(parseInt(r))}).then(function(t){e([!0,t]),fetch(n.DATABASE_URL+"restaurants/"+r).then(function(t){return t.json()}).then(function(r){e([!0,r]),n.dbPromise.then(function(t){var e=t.transaction("restaurants","readwrite");return e.objectStore("restaurants").put(r),e.complete})}).catch(function(t){return e([!1,t])})})}},{key:"fetchRestaurantById",value:function(t,a){this.fetchRestaurant(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=_slicedToArray(t,2),r=e[0],n=void 0!==r&&r,i=e[1];a(n,i)},t)}},{key:"fetchReviewsByRestaurantId",value:function(e,r){var n=this;this.dbPromise.then(function(t){return t.transaction("reviews").objectStore("reviews").index("restaurant_id").getAll(parseInt(e))}).then(function(t){r([!0,t]),fetch(n.DATABASE_URL+"reviews/?restaurant_id="+e).then(function(t){return t.json()}).then(function(c){r([!0,c]),n.dbPromise.then(function(t){var e=t.transaction("reviews","readwrite"),r=e.objectStore("reviews"),n=!0,i=!1,a=void 0;try{for(var o,u=c[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;r.put(s)}}catch(t){i=!0,a=t}finally{try{!n&&u.return&&u.return()}finally{if(i)throw a}}return e.complete})}).catch(function(t){return r([!1,t])})})}},{key:"fetchRestaurantByCuisine",value:function(o,u){this.fetchRestaurants(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=_slicedToArray(t,2),r=e[0],n=void 0!==r&&r,i=e[1];if(n){var a=i.filter(function(t){return t.cuisine_type==o});u(n,a)}else u(n,i)})}},{key:"fetchRestaurantByNeighborhood",value:function(o,u){this.fetchRestaurants(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=_slicedToArray(t,2),r=e[0],n=void 0!==r&&r,i=e[1];if(n){var a=i.filter(function(t){return t.neighborhood==o});u(n,a)}else u(n,i)})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(o,u,s){this.fetchRestaurants(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=_slicedToArray(t,2),r=e[0],n=void 0!==r&&r,i=e[1];if(n){var a=i;"all"!=o&&(a=a.filter(function(t){return t.cuisine_type==o})),"all"!=u&&(a=a.filter(function(t){return t.neighborhood==u})),s(n,a)}else s(n,i)})}},{key:"fetchNeighborhoods",value:function(u){this.fetchRestaurants(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=_slicedToArray(t,2),r=e[0],n=void 0!==r&&r,i=e[1];if(n){var a=i.map(function(t,e){return i[e].neighborhood}),o=a.filter(function(t,e){return a.indexOf(t)==e});u(n,o)}else u(n,i)})}},{key:"fetchCuisines",value:function(u){this.fetchRestaurants(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=_slicedToArray(t,2),r=e[0],n=void 0!==r&&r,i=e[1];if(n){var a=i.map(function(t,e){return i[e].cuisine_type}),o=a.filter(function(t,e){return a.indexOf(t)==e});u(n,o)}else u(n,i)})}},{key:"urlForRestaurant",value:function(t){return"./restaurant.html?id="+t.id}},{key:"imageUrlForRestaurant",value:function(t){return"/img/"+t.photograph+".jpf"}},{key:"imageNameForRestaurant",value:function(t){return(t.photograph||"5.jpf").replace(/\.jpf$/,"")}},{key:"mapMarkerForRestaurant",value:function(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:this.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}},{key:"submitReview",value:function(t,e){fetch(this.DATABASE_URL+"reviews",{method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(t)}).then(function(t){return t.json()}).then(function(t){e([!0,t])}).catch(function(t){return e([!1,t])})}},{key:"cacheReviewSubmission",value:function(e){this.dbPromise.then(function(t){return t.transaction("reviews-to-submit","readwrite").objectStore("reviews-to-submit").put(e)}).catch(function(t){return console.error("Wasn't able to cache review submission")})}},{key:"deleteCachedReview",value:function(e){return this.dbPromise.then(function(t){return t.transaction("reviews-to-submit","readwrite").objectStore("reviews-to-submit").delete(e)}).catch(function(t){return console.error("Wasn't able to delete cached review submission of ID: "+e,t)})}},{key:"submitCachedReview",value:function(e){var u=this;this.dbPromise.then(function(t){return t.transaction("reviews-to-submit").objectStore("reviews-to-submit").index("restaurant_id").getAll(e)}).then(function(t){if(t.length){var e=!0,r=!1,n=void 0;try{for(var a,i=function(){var i=a.value;u.submitReview(i,function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=_slicedToArray(t,2),r=e[0],n=void 0!==r&&r;e[1];n&&u.deleteCachedReview(i.cache_id)})},o=t[Symbol.iterator]();!(e=(a=o.next()).done);e=!0)i()}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}}).catch(function(t){return console.info("Wasn't able get cached review submissions of restaurant ID: "+e,t)})}},{key:"submitCachedFavouriteRestaurant",value:function(e){var r=this,n=this.dbPromise;n.then(function(t){return t.transaction("favourite-to-submit").objectStore("favourite-to-submit").get(e)}).then(function(t){t&&r.togglefavouriteRestaurant(e,t.is_favorite,function(t){t&&n.then(function(t){t.transaction("favourite-to-submit","readwrite").objectStore("favourite-to-submit").delete(e)})})})}},{key:"togglefavouriteRestaurant",value:function(r,n,i){var e=this;fetch(this.DATABASE_URL+"restaurants/"+r+"/?is_favorite="+n,{method:"PUT"}).then(function(t){return t.json()}).then(function(r){e.dbPromise.then(function(t){var e=t.transaction("restaurants","readwrite");return e.objectStore("restaurants").put(r),i&&i(e.complete),e.complete})}).catch(function(t){e.dbPromise.then(function(t){var e=t.transaction("favourite-to-submit","readwrite");return e.objectStore("favourite-to-submit","readwrite").put({restaurant_id:r,is_favorite:n}),i&&i(!1),e.complete})})}},{key:"DATABASE_URL",get:function(){return"//localhost:1337/"}}]),t}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNlcnZpY2VXb3JrZXJDb250cm9sbGVyLmpzIiwiaWRiLmpzIiwiZGJoZWxwZXIuanMiXSwibmFtZXMiOlsiU2VydmljZVdvcmtlckNvbnRyb2xsZXIiLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwiX3JlZ2lzdGVyU2VydmljZVdvcmtlciIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsInByb21pc2lmeVJlcXVlc3QiLCJyZXF1ZXN0IiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJvbnN1Y2Nlc3MiLCJyZXN1bHQiLCJvbmVycm9yIiwiZXJyb3IiLCJwcm9taXNpZnlSZXF1ZXN0Q2FsbCIsIm9iaiIsIm1ldGhvZCIsImFyZ3MiLCJwIiwiYXBwbHkiLCJ0aGVuIiwicHJveHlQcm9wZXJ0aWVzIiwiUHJveHlDbGFzcyIsInRhcmdldFByb3AiLCJwcm9wZXJ0aWVzIiwiZm9yRWFjaCIsInByb3AiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsInByb3RvdHlwZSIsImdldCIsInNldCIsInZhbCIsInByb3h5UmVxdWVzdE1ldGhvZHMiLCJDb25zdHJ1Y3RvciIsImFyZ3VtZW50cyIsInByb3h5TWV0aG9kcyIsInByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMiLCJ2YWx1ZSIsIkN1cnNvciIsIkluZGV4IiwiaW5kZXgiLCJfaW5kZXgiLCJfY3Vyc29yIiwiY3Vyc29yIiwiY29tcGxldGUiLCJzdG9yZSIsImlkYlRyYW5zYWN0aW9uIiwiVHJhbnNhY3Rpb24iLCJfdHgiLCJvbmNvbXBsZXRlIiwib25hYm9ydCIsIk9iamVjdFN0b3JlIiwiaXRlbXMiLCJkYiIsIm9sZFZlcnNpb24iLCJ0cmFuc2FjdGlvbiIsIl9kYiIsImluc3RhbmNlIiwiaXRlcmF0ZUN1cnNvciIsIm9wZW4iLCJEQiIsIklEQkluZGV4IiwiSURCQ3Vyc29yIiwibWV0aG9kTmFtZSIsIl9yZXF1ZXN0IiwiSURCT2JqZWN0U3RvcmUiLCJfc3RvcmUiLCJJREJUcmFuc2FjdGlvbiIsIlVwZ3JhZGVEQiIsIm5hdGl2ZU9iamVjdCIsImZ1bmNOYW1lIiwib2JqZWN0U3RvcmUiLCJjcmVhdGVPYmplY3RTdG9yZSIsImNvdW50IiwidW5kZWZpbmVkIiwiSURCRGF0YWJhc2UiLCJvbnVwZ3JhZGVuZWVkZWQiLCJ1cGdyYWRlQ2FsbGJhY2siLCJkZWxldGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGVmYXVsdCIsInJlcGxhY2UiLCJzZWxmIiwiYXJyIiwiQXJyYXkiLCJzbGljZSIsImNhbGwiLCJjYWxsYmFjayIsImxlbmd0aCIsImdldEFsbCIsInF1ZXJ5IiwicHVzaCIsImNvbnRpbnVlIiwiZXhwIiwibmFtZSIsInZlcnNpb24iLCJpbmRleGVkREIiLCJldmVudCIsImlkYiIsIkRCSGVscGVyIiwiZGJQcm9taXNlIiwidXBncmFkZURiIiwia2V5UGF0aCIsImNyZWF0ZUluZGV4IiwiX3RoaXMiLCJyZXN0YXVyYW50cyIsImZldGNoIiwicmVzcG9uc2UiLCJqc29uIiwiZGF0YSIsInR4IiwiX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiIsIl9kaWRJdGVyYXRvckVycm9yIiwiX2l0ZXJhdG9yRXJyb3IiLCJfc3RlcCIsIl9pdGVyYXRvciIsIlN5bWJvbCIsIml0ZXJhdG9yIiwibmV4dCIsImRvbmUiLCJwdXQiLCJyZXN0YXVyYW50IiwiZXJyIiwicmV0dXJuIiwiY2F0Y2giLCJpZCIsIl90aGlzMiIsInBhcnNlSW50IiwiREFUQUJBU0VfVVJMIiwiZmV0Y2hSZXN0YXVyYW50IiwiX3JlZiIsIl9yZWYyIiwiX3NsaWNlZFRvQXJyYXkiLCJfcmVmMiQiLCJvayIsInJlc3RhdXJhbnRfaWQiLCJfdGhpczMiLCJyZXZpZXdzIiwiX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjIiLCJfZGlkSXRlcmF0b3JFcnJvcjIiLCJfaXRlcmF0b3JFcnJvcjIiLCJfc3RlcDIiLCJfaXRlcmF0b3IyIiwicmV2aWV3IiwiY3Vpc2luZSIsImZldGNoUmVzdGF1cmFudHMiLCJfcmVmMyIsIl9yZWY0IiwiX3JlZjQkIiwiZmlsdGVyIiwiciIsImN1aXNpbmVfdHlwZSIsInJlc3VsdHMiLCJuZWlnaGJvcmhvb2QiLCJfcmVmNSIsIl9yZWY2IiwiX3JlZjYkIiwiX3JlZjciLCJfcmVmOCIsIl9yZWY4JCIsIl9yZWY5IiwiX3JlZjEwIiwiX3JlZjEwJCIsIm1hcCIsInYiLCJpIiwidW5pcXVlTmVpZ2hib3Job29kcyIsIm5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwiX3JlZjExIiwiX3JlZjEyIiwiX3JlZjEyJCIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJwaG90b2dyYXBoIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsInVybCIsImFuaW1hdGlvbiIsImdvb2dsZSIsIm1hcHMiLCJBbmltYXRpb24iLCJEUk9QIiwianNvbkZvcm1EYXRhIiwiaGVhZGVycyIsIkhlYWRlcnMiLCJDb250ZW50LVR5cGUiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIm5ld1JldmlldyIsImNhY2hlX2lkIiwiX3RoaXM0IiwiY2FjaGVkUmV2aWV3cyIsIl9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zIiwiX2RpZEl0ZXJhdG9yRXJyb3IzIiwiX2l0ZXJhdG9yRXJyb3IzIiwiX3N0ZXAzIiwiX2xvb3AiLCJjYWNoZWRSZXZpZXciLCJzdWJtaXRSZXZpZXciLCJfcmVmMTMiLCJfcmVmMTQiLCJfcmVmMTQkIiwiZGVsZXRlQ2FjaGVkUmV2aWV3IiwiX2l0ZXJhdG9yMyIsImNvbnNvbGUiLCJfdGhpczUiLCJ0aGlzZGJQcm9taXNlIiwiY2FjaGVkUmVzdGF1cmFudCIsInRvZ2dsZWZhdm91cml0ZVJlc3RhdXJhbnQiLCJpc19mYXZvcml0ZSIsImNoZWNrZWQiLCJfdGhpczYiXSwibWFwcGluZ3MiOiJpWUFBTUEsbUNBRUosU0FBQUEsSUFBY0MsZ0JBQUFDLEtBQUFGLEdBQ1pFLEtBQUtDLCtGQUFMQyxVQUFLRCxlQUNOQyxVQUFBQyxjQUFBQyxTQUFBLGtCQWFILElBQUlOO0FDakJKLGNB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QUFBMUMsSUFBQTJHLEtBQ0FySCxLQUFBLFNBQUFpTSxHQUFpREEsR0FBQUYsRUFBakRHLDBCQUFBN0UsRUFBQTRFLEVBQUFFLFlBQUEsU0FBQS9FLEdBQ0EvQyxHQUNEMkgsRUFBQWhNLEtBQUEsU0FBQWtDLEdBVEhBLEVBQUFFLFlBQUEsc0JBQUEsYUFBQWdCLFlBQUEsdUJBQUFPLE9BQUEwRCwyREF5SXdCQSxFQUFlK0UsRUFBUy9ILEdBQVUsSUFBQWdJLEVBQUF6TixLQUMxRDRHLE1BQU01RyxLQUFLa0ksYUFBTCxlQTFIZ0JPLEVBMEhoQixpQkExSGdCK0UsRUFBQSxDQUN0QnhNLE9BQUEsUUFDQUksS0FBSytILFNBQUFBLEdBQUFBLE9BQUFBLEVBQWlCckMsU0FBaUMxRixLQUFBLFNBQUF1RyxHQUFBOEYsRUFBQW5ILFVBQUFsRixLQUFBLFNBQUFrQyxHQUFBLElBQUEwRCxFQUFBMUQsRUFBQUUsWUFBQSxjQUFBLGFBRW5EaUMsT0FGbUR1QixFQUEvQndCLFlBQStCLGVBQUFkLElBQTFCQyxHQUFPZCxHQWdJNUJwQixFQUFTdUIsRUFBR25FLFVBOUhoQjRDLEVBQ0UrQyxhQUdGVixNQUFBLFNBQUFqSCxHQUE4QjRNLEVBQUFuSCxVQUFVTyxLQUFTMEQsU0FBQUEsR0FBbkIsSUFBOUJ2RCxFQUFBMUQsRUFBQUUsWUFBQSxzQkFBQSxhQU1MLE9BTEt3RCxFQUFBeEMsWUFBQSxzQkFBQSxhQUFBa0QsSUFBQSxDQUNBZSxjQUFNc0MsRUFBaUN3QyxZQUFVekMsSUFDakRyRixHQUNEQSxHQUFBLEdBRUp1QixFQUFBbkUsa0RBbE5BLE1BQUEiLCJmaWxlIjoiY29tbW9ucy5qcyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIFNlcnZpY2VXb3JrZXJDb250cm9sbGVyIHtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLl9yZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqICBSZWdpc3RlciB0aGUgU2VydmljZSBXb3JrZXJcclxuICAgKi9cclxuICBfcmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCkge1xyXG4gICAgaWYgKG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XHJcbiAgICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCdzdy5qcycpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbn1cclxuXHJcbm5ldyBTZXJ2aWNlV29ya2VyQ29udHJvbGxlcigpO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcclxuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XHJcbiAgICB2YXIgcmVxdWVzdDtcclxuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xyXG4gICAgICBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHAucmVxdWVzdCA9IHJlcXVlc3Q7XHJcbiAgICByZXR1cm4gcDtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XHJcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcclxuICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xyXG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcHJveHlQcm9wZXJ0aWVzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIHByb3BlcnRpZXMpIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24odmFsKSB7XHJcbiAgICAgICAgICB0aGlzW3RhcmdldFByb3BdW3Byb3BdID0gdmFsO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb3h5UmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBwcm94eU1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBJbmRleChpbmRleCkge1xyXG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcclxuICB9XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFtcclxuICAgICduYW1lJyxcclxuICAgICdrZXlQYXRoJyxcclxuICAgICdtdWx0aUVudHJ5JyxcclxuICAgICd1bmlxdWUnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xyXG4gICAgJ2dldCcsXHJcbiAgICAnZ2V0S2V5JyxcclxuICAgICdnZXRBbGwnLFxyXG4gICAgJ2dldEFsbEtleXMnLFxyXG4gICAgJ2NvdW50J1xyXG4gIF0pO1xyXG5cclxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcclxuICAgICdvcGVuQ3Vyc29yJyxcclxuICAgICdvcGVuS2V5Q3Vyc29yJ1xyXG4gIF0pO1xyXG5cclxuICBmdW5jdGlvbiBDdXJzb3IoY3Vyc29yLCByZXF1ZXN0KSB7XHJcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XHJcbiAgICB0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcclxuICB9XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgW1xyXG4gICAgJ2RpcmVjdGlvbicsXHJcbiAgICAna2V5JyxcclxuICAgICdwcmltYXJ5S2V5JyxcclxuICAgICd2YWx1ZSdcclxuICBdKTtcclxuXHJcbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhDdXJzb3IsICdfY3Vyc29yJywgSURCQ3Vyc29yLCBbXHJcbiAgICAndXBkYXRlJyxcclxuICAgICdkZWxldGUnXHJcbiAgXSk7XHJcblxyXG4gIC8vIHByb3h5ICduZXh0JyBtZXRob2RzXHJcbiAgWydhZHZhbmNlJywgJ2NvbnRpbnVlJywgJ2NvbnRpbnVlUHJpbWFyeUtleSddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kTmFtZSkge1xyXG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG4gICAgQ3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICB2YXIgY3Vyc29yID0gdGhpcztcclxuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGN1cnNvci5fY3Vyc29yW21ldGhvZE5hbWVdLmFwcGx5KGN1cnNvci5fY3Vyc29yLCBhcmdzKTtcclxuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICAgIGlmICghdmFsdWUpIHJldHVybjtcclxuICAgICAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBjdXJzb3IuX3JlcXVlc3QpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH07XHJcbiAgfSk7XHJcblxyXG4gIGZ1bmN0aW9uIE9iamVjdFN0b3JlKHN0b3JlKSB7XHJcbiAgICB0aGlzLl9zdG9yZSA9IHN0b3JlO1xyXG4gIH1cclxuXHJcbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmNyZWF0ZUluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcclxuICB9O1xyXG5cclxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuaW5kZXggPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuaW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xyXG4gIH07XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIFtcclxuICAgICduYW1lJyxcclxuICAgICdrZXlQYXRoJyxcclxuICAgICdpbmRleE5hbWVzJyxcclxuICAgICdhdXRvSW5jcmVtZW50J1xyXG4gIF0pO1xyXG5cclxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcclxuICAgICdwdXQnLFxyXG4gICAgJ2FkZCcsXHJcbiAgICAnZGVsZXRlJyxcclxuICAgICdjbGVhcicsXHJcbiAgICAnZ2V0JyxcclxuICAgICdnZXRBbGwnLFxyXG4gICAgJ2dldEtleScsXHJcbiAgICAnZ2V0QWxsS2V5cycsXHJcbiAgICAnY291bnQnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xyXG4gICAgJ29wZW5DdXJzb3InLFxyXG4gICAgJ29wZW5LZXlDdXJzb3InXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXHJcbiAgICAnZGVsZXRlSW5kZXgnXHJcbiAgXSk7XHJcblxyXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XHJcbiAgICB0aGlzLl90eCA9IGlkYlRyYW5zYWN0aW9uO1xyXG4gICAgdGhpcy5jb21wbGV0ZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICB9O1xyXG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcclxuICAgICAgfTtcclxuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XHJcbiAgfTtcclxuXHJcbiAgcHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgW1xyXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnLFxyXG4gICAgJ21vZGUnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbXHJcbiAgICAnYWJvcnQnXHJcbiAgXSk7XHJcblxyXG4gIGZ1bmN0aW9uIFVwZ3JhZGVEQihkYiwgb2xkVmVyc2lvbiwgdHJhbnNhY3Rpb24pIHtcclxuICAgIHRoaXMuX2RiID0gZGI7XHJcbiAgICB0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xyXG4gICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XHJcbiAgfVxyXG5cclxuICBVcGdyYWRlREIucHJvdG90eXBlLmNyZWF0ZU9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX2RiLmNyZWF0ZU9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcclxuICB9O1xyXG5cclxuICBwcm94eVByb3BlcnRpZXMoVXBncmFkZURCLCAnX2RiJywgW1xyXG4gICAgJ25hbWUnLFxyXG4gICAgJ3ZlcnNpb24nLFxyXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5TWV0aG9kcyhVcGdyYWRlREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xyXG4gICAgJ2RlbGV0ZU9iamVjdFN0b3JlJyxcclxuICAgICdjbG9zZSdcclxuICBdKTtcclxuXHJcbiAgZnVuY3Rpb24gREIoZGIpIHtcclxuICAgIHRoaXMuX2RiID0gZGI7XHJcbiAgfVxyXG5cclxuICBEQi5wcm90b3R5cGUudHJhbnNhY3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xyXG4gIH07XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFtcclxuICAgICduYW1lJyxcclxuICAgICd2ZXJzaW9uJyxcclxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xyXG4gIF0pO1xyXG5cclxuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xyXG4gICAgJ2Nsb3NlJ1xyXG4gIF0pO1xyXG5cclxuICAvLyBBZGQgY3Vyc29yIGl0ZXJhdG9yc1xyXG4gIC8vIFRPRE86IHJlbW92ZSB0aGlzIG9uY2UgYnJvd3NlcnMgZG8gdGhlIHJpZ2h0IHRoaW5nIHdpdGggcHJvbWlzZXNcclxuICBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddLmZvckVhY2goZnVuY3Rpb24oZnVuY05hbWUpIHtcclxuICAgIFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcclxuICAgICAgQ29uc3RydWN0b3IucHJvdG90eXBlW2Z1bmNOYW1lLnJlcGxhY2UoJ29wZW4nLCAnaXRlcmF0ZScpXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpO1xyXG4gICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcclxuICAgICAgICB2YXIgbmF0aXZlT2JqZWN0ID0gdGhpcy5fc3RvcmUgfHwgdGhpcy5faW5kZXg7XHJcbiAgICAgICAgdmFyIHJlcXVlc3QgPSBuYXRpdmVPYmplY3RbZnVuY05hbWVdLmFwcGx5KG5hdGl2ZU9iamVjdCwgYXJncy5zbGljZSgwLCAtMSkpO1xyXG4gICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICBjYWxsYmFjayhyZXF1ZXN0LnJlc3VsdCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICAvLyBwb2x5ZmlsbCBnZXRBbGxcclxuICBbSW5kZXgsIE9iamVjdFN0b3JlXS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XHJcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xyXG4gICAgQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCA9IGZ1bmN0aW9uKHF1ZXJ5LCBjb3VudCkge1xyXG4gICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xyXG4gICAgICB2YXIgaXRlbXMgPSBbXTtcclxuXHJcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XHJcbiAgICAgICAgaW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24oY3Vyc29yKSB7XHJcbiAgICAgICAgICBpZiAoIWN1cnNvcikge1xyXG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xyXG5cclxuICAgICAgICAgIGlmIChjb3VudCAhPT0gdW5kZWZpbmVkICYmIGl0ZW1zLmxlbmd0aCA9PSBjb3VudCkge1xyXG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuICB9KTtcclxuXHJcbiAgdmFyIGV4cCA9IHtcclxuICAgIG9wZW46IGZ1bmN0aW9uKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xyXG4gICAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ29wZW4nLCBbbmFtZSwgdmVyc2lvbl0pO1xyXG4gICAgICB2YXIgcmVxdWVzdCA9IHAucmVxdWVzdDtcclxuXHJcbiAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgICBpZiAodXBncmFkZUNhbGxiYWNrKSB7XHJcbiAgICAgICAgICB1cGdyYWRlQ2FsbGJhY2sobmV3IFVwZ3JhZGVEQihyZXF1ZXN0LnJlc3VsdCwgZXZlbnQub2xkVmVyc2lvbiwgcmVxdWVzdC50cmFuc2FjdGlvbikpO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24oZGIpIHtcclxuICAgICAgICByZXR1cm4gbmV3IERCKGRiKTtcclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZGVsZXRlOiBmdW5jdGlvbihuYW1lKSB7XHJcbiAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdkZWxldGVEYXRhYmFzZScsIFtuYW1lXSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGV4cDtcclxuICAgIG1vZHVsZS5leHBvcnRzLmRlZmF1bHQgPSBtb2R1bGUuZXhwb3J0cztcclxuICB9IGVsc2Uge1xyXG4gICAgc2VsZi5pZGIgPSBleHA7XHJcbiAgfVxyXG59KCkpOyIsIi8qanNoaW50IGVzdmVyc2lvbjogNiAqL1xyXG5cclxuLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxuY2xhc3MgREJIZWxwZXIge1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuZGJQcm9taXNlID0gaWRiLm9wZW4oJ3Jlc3RhdXJhbnQtcmV2aWV3cycsIDEsIHVwZ3JhZGVEYiA9PiB7XHJcbiAgICAgIHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudHMnLCB7XHJcbiAgICAgICAga2V5UGF0aDogJ2lkJ1xyXG4gICAgICB9KTtcclxuICAgICAgdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXZpZXdzJywge1xyXG4gICAgICAgIGtleVBhdGg6ICdpZCdcclxuICAgICAgfSkuY3JlYXRlSW5kZXgoJ3Jlc3RhdXJhbnRfaWQnLCAncmVzdGF1cmFudF9pZCcpO1xyXG5cclxuICAgICAgdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXZpZXdzLXRvLXN1Ym1pdCcsIHtcclxuICAgICAgICBrZXlQYXRoOiAnY2FjaGVfaWQnLFxyXG4gICAgICAgIGF1dG9JbmNyZW1lbnQ6IHRydWVcclxuICAgICAgfSkuY3JlYXRlSW5kZXgoJ3Jlc3RhdXJhbnRfaWQnLCAncmVzdGF1cmFudF9pZCcpO1xyXG5cclxuICAgICAgdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdmYXZvdXJpdGUtdG8tc3VibWl0Jywge1xyXG4gICAgICAgIGtleVBhdGg6ICdyZXN0YXVyYW50X2lkJyxcclxuICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAqL1xyXG4gIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNzsgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgcmV0dXJuIGAvL2xvY2FsaG9zdDoke3BvcnR9L2A7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBEQiBpZiBwb3NzaWJsZS5cclxuICAgKi9cclxuICBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcblxyXG4gICAgLy8gRmlyc3QgZ2V0IHJlc3RhdXJhbnRzIGZyb20gdGhlIGRhdGFiYXNlIGFuZCB0aGVuIGZyb20gdGhlIHdlYlxyXG4gICAgdGhpcy5kYlByb21pc2UudGhlbihkYiA9PiB7XHJcblxyXG4gICAgICByZXR1cm4gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJykub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJykuZ2V0QWxsKCk7XHJcblxyXG4gICAgfSkudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcblxyXG4gICAgICAvLyBEaXNwbGF5IHJlc3RhdXJhbnRzIGZyb20gdGhlIGRhdGFiYXNlXHJcbiAgICAgIGNhbGxiYWNrKFt0cnVlLCByZXN0YXVyYW50c10pO1xyXG5cclxuICAgICAgLy8gR2V0IHJlc3RhdXJhbnRzIGZyb20gdGhlIHdlYlxyXG4gICAgICBmZXRjaCh0aGlzLkRBVEFCQVNFX1VSTCArICdyZXN0YXVyYW50cycpXHJcbiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxyXG4gICAgICAgIC50aGVuKGRhdGEgPT4ge1xyXG4gICAgICAgICAgY2FsbGJhY2soW3RydWUsIGRhdGFdKTtcclxuXHJcbiAgICAgICAgICAvLyBBZGQgcmVzdGF1cmFudHMgZnJvbSB0aGUgd2ViIHRvIHRoZSBkYXRhYmFzZVxyXG4gICAgICAgICAgdGhpcy5kYlByb21pc2UudGhlbihkYiA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgICAgICBjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xyXG5cclxuICAgICAgICAgICAgZm9yIChjb25zdCByZXN0YXVyYW50IG9mIGRhdGEpIHtcclxuICAgICAgICAgICAgICBzdG9yZS5wdXQocmVzdGF1cmFudCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKFtmYWxzZSwgZXJyb3JdKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50IGJ5IElEIGZyb20gREIgaWYgcG9zc2libGUuXHJcbiAgICovXHJcbiAgZmV0Y2hSZXN0YXVyYW50KGNhbGxiYWNrLCBpZCkge1xyXG5cclxuICAgIC8vIEZpcnN0IGdldCByZXN0YXVyYW50cyBmcm9tIHRoZSBkYXRhYmFzZSBhbmQgdGhlbiBmcm9tIHRoZSB3ZWJcclxuICAgIHRoaXMuZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xyXG4gICAgICByZXR1cm4gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJykub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJykuZ2V0KHBhcnNlSW50KGlkKSk7XHJcbiAgICB9KS50aGVuKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgICAvLyBEaXNwbGF5IHJlc3RhdXJhbnRzIGZyb20gdGhlIGRhdGFiYXNlXHJcbiAgICAgIGNhbGxiYWNrKFt0cnVlLCByZXN0YXVyYW50XSk7XHJcblxyXG4gICAgICAvLyBHZXQgcmVzdGF1cmFudHMgZnJvbSB0aGUgd2ViXHJcbiAgICAgIGZldGNoKHRoaXMuREFUQUJBU0VfVVJMICsgYHJlc3RhdXJhbnRzLyR7aWR9YClcclxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcbiAgICAgICAgLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgICAgICBjYWxsYmFjayhbdHJ1ZSwgZGF0YV0pO1xyXG5cclxuICAgICAgICAgIC8vIEFkZCByZXN0YXVyYW50cyBmcm9tIHRoZSB3ZWIgdG8gdGhlIGRhdGFiYXNlXHJcbiAgICAgICAgICB0aGlzLmRiUHJvbWlzZS50aGVuKGRiID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgICAgIHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpLnB1dChkYXRhKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKFtmYWxzZSwgZXJyb3JdKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXHJcbiAgICovXHJcbiAgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgIHRoaXMuZmV0Y2hSZXN0YXVyYW50KChbb2sgPSBmYWxzZSwgcmVzcG9uc2VdID0gW10pID0+IHtcclxuICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgIGNhbGxiYWNrKG9rLCByZXNwb25zZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY2FsbGJhY2sob2ssIHJlc3BvbnNlKTtcclxuICAgICAgfVxyXG4gICAgfSwgaWQpO1xyXG4gIH1cclxuXHJcbiAgZmV0Y2hSZXZpZXdzQnlSZXN0YXVyYW50SWQocmVzdGF1cmFudF9pZCwgY2FsbGJhY2spIHtcclxuXHJcbiAgICB0aGlzLmRiUHJvbWlzZS50aGVuKGRiID0+IHtcclxuICAgICAgcmV0dXJuIGRiLnRyYW5zYWN0aW9uKCdyZXZpZXdzJykub2JqZWN0U3RvcmUoJ3Jldmlld3MnKS5pbmRleCgncmVzdGF1cmFudF9pZCcpLmdldEFsbChwYXJzZUludChyZXN0YXVyYW50X2lkKSk7XHJcbiAgICB9KS50aGVuKHJldmlld3MgPT4ge1xyXG4gICAgICAvLyBEaXNwbGF5IHJlc3RhdXJhbnRzIGZyb20gdGhlIGRhdGFiYXNlXHJcbiAgICAgIGNhbGxiYWNrKFt0cnVlLCByZXZpZXdzXSk7XHJcblxyXG4gICAgICAvLyBHZXQgcmVzdGF1cmFudHMgZnJvbSB0aGUgd2ViXHJcbiAgICAgIGZldGNoKHRoaXMuREFUQUJBU0VfVVJMICsgYHJldmlld3MvP3Jlc3RhdXJhbnRfaWQ9JHtyZXN0YXVyYW50X2lkfWApXHJcbiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxyXG4gICAgICAgIC50aGVuKGRhdGEgPT4ge1xyXG4gICAgICAgICAgY2FsbGJhY2soW3RydWUsIGRhdGFdKTtcclxuXHJcbiAgICAgICAgICAvLyBBZGQgcmVzdGF1cmFudHMgZnJvbSB0aGUgd2ViIHRvIHRoZSBkYXRhYmFzZVxyXG4gICAgICAgICAgdGhpcy5kYlByb21pc2UudGhlbihkYiA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jldmlld3MnLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jldmlld3MnKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgcmV2aWV3IG9mIGRhdGEpIHtcclxuICAgICAgICAgICAgICBzdG9yZS5wdXQocmV2aWV3KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4gY2FsbGJhY2soW2ZhbHNlLCBlcnJvcl0pKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXHJcbiAgICB0aGlzLmZldGNoUmVzdGF1cmFudHMoKFtvayA9IGZhbHNlLCByZXNwb25zZV0gPSBbXSkgPT4ge1xyXG4gICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgY2FsbGJhY2sob2ssIHJlc3BvbnNlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXNwb25zZS5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICBjYWxsYmFjayhvaywgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICB0aGlzLmZldGNoUmVzdGF1cmFudHMoKFtvayA9IGZhbHNlLCByZXNwb25zZV0gPSBbXSkgPT4ge1xyXG4gICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgY2FsbGJhY2sob2ssIHJlc3BvbnNlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXNwb25zZS5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIGNhbGxiYWNrKG9rLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIHRoaXMuZmV0Y2hSZXN0YXVyYW50cygoW29rID0gZmFsc2UsIHJlc3BvbnNlXSA9IFtdKSA9PiB7XHJcbiAgICAgIGlmICghb2spIHtcclxuICAgICAgICBjYWxsYmFjayhvaywgcmVzcG9uc2UpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzcG9uc2U7XHJcbiAgICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhbGxiYWNrKG9rLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgdGhpcy5mZXRjaFJlc3RhdXJhbnRzKChbb2sgPSBmYWxzZSwgcmVzcG9uc2VdID0gW10pID0+IHtcclxuICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgIGNhbGxiYWNrKG9rLCByZXNwb25zZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3BvbnNlLm1hcCgodiwgaSkgPT4gcmVzcG9uc2VbaV0ubmVpZ2hib3Job29kKTtcclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcclxuICAgICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKTtcclxuICAgICAgICBjYWxsYmFjayhvaywgdW5pcXVlTmVpZ2hib3Job29kcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgdGhpcy5mZXRjaFJlc3RhdXJhbnRzKChbb2sgPSBmYWxzZSwgcmVzcG9uc2VdID0gW10pID0+IHtcclxuICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgIGNhbGxiYWNrKFxyXG4gICAgICAgICAgb2ssIHJlc3BvbnNlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXNwb25zZS5tYXAoKHYsIGkpID0+IHJlc3BvbnNlW2ldLmN1aXNpbmVfdHlwZSk7XHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpO1xyXG4gICAgICAgIGNhbGxiYWNrKG9rLCB1bmlxdWVDdWlzaW5lcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxyXG4gICAqL1xyXG4gIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofS5qcGZgKTtcclxuICB9XHJcblxyXG4gIGltYWdlTmFtZUZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChyZXN0YXVyYW50LnBob3RvZ3JhcGggfHwgJzUuanBmJykucmVwbGFjZSgvXFwuanBmJC8sICcnKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cclxuICAgKi9cclxuICBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgdXJsOiB0aGlzLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgIG1hcDogbWFwLFxyXG4gICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBtYXJrZXI7XHJcbiAgfVxyXG5cclxuICBzdWJtaXRSZXZpZXcoanNvbkZvcm1EYXRhLCBjYWxsYmFjaykge1xyXG5cclxuICAgIGZldGNoKHRoaXMuREFUQUJBU0VfVVJMICsgJ3Jldmlld3MnLCB7XHJcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgaGVhZGVyczogbmV3IEhlYWRlcnMoe1xyXG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgICAgfSksXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoanNvbkZvcm1EYXRhKVxyXG4gICAgICB9KVxyXG4gICAgICAudGhlbihyYXdEYXRhID0+IHJhd0RhdGEuanNvbigpKVxyXG4gICAgICAudGhlbihuZXdSZXZpZXcgPT4ge1xyXG4gICAgICAgIGNhbGxiYWNrKFt0cnVlLCBuZXdSZXZpZXddKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKFtmYWxzZSwgZXJyb3JdKSk7XHJcbiAgfVxyXG5cclxuICBjYWNoZVJldmlld1N1Ym1pc3Npb24oanNvbkZvcm1EYXRhKSB7XHJcblxyXG4gICAgdGhpcy5kYlByb21pc2UudGhlbihkYiA9PiB7XHJcblxyXG4gICAgICByZXR1cm4gZGIudHJhbnNhY3Rpb24oJ3Jldmlld3MtdG8tc3VibWl0JywgJ3JlYWR3cml0ZScpLm9iamVjdFN0b3JlKCdyZXZpZXdzLXRvLXN1Ym1pdCcpLnB1dChqc29uRm9ybURhdGEpO1xyXG5cclxuICAgIH0pLmNhdGNoKGVycm9yID0+IGNvbnNvbGUuZXJyb3IoJ1dhc25cXCd0IGFibGUgdG8gY2FjaGUgcmV2aWV3IHN1Ym1pc3Npb24nKSk7XHJcblxyXG4gIH1cclxuXHJcbiAgZGVsZXRlQ2FjaGVkUmV2aWV3KGNhY2hlX2lkKSB7XHJcbiAgICByZXR1cm4gdGhpcy5kYlByb21pc2UudGhlbihkYiA9PiB7XHJcbiAgICAgIHJldHVybiBkYi50cmFuc2FjdGlvbigncmV2aWV3cy10by1zdWJtaXQnLCAncmVhZHdyaXRlJykub2JqZWN0U3RvcmUoJ3Jldmlld3MtdG8tc3VibWl0JykuZGVsZXRlKGNhY2hlX2lkKTtcclxuICAgIH0pLmNhdGNoKGVycm9yID0+IGNvbnNvbGUuZXJyb3IoYFdhc24ndCBhYmxlIHRvIGRlbGV0ZSBjYWNoZWQgcmV2aWV3IHN1Ym1pc3Npb24gb2YgSUQ6ICR7Y2FjaGVfaWR9YCwgZXJyb3IpKTtcclxuICB9XHJcblxyXG4gIHN1Ym1pdENhY2hlZFJldmlldyhyZXN0YXVyYW50X2lkKSB7XHJcbiAgICB0aGlzLmRiUHJvbWlzZS50aGVuKGRiID0+IHtcclxuICAgICAgcmV0dXJuIGRiLnRyYW5zYWN0aW9uKCdyZXZpZXdzLXRvLXN1Ym1pdCcpLm9iamVjdFN0b3JlKCdyZXZpZXdzLXRvLXN1Ym1pdCcpLmluZGV4KCdyZXN0YXVyYW50X2lkJykuZ2V0QWxsKHJlc3RhdXJhbnRfaWQpO1xyXG4gICAgfSkudGhlbihjYWNoZWRSZXZpZXdzID0+IHtcclxuXHJcbiAgICAgIC8vVGhlcmUgYXJlIG5vIGNhY2hlZCByZXZpZXdzIHdhaXRpbmcgZm9yIHN1Ym1pc3Npb25cclxuICAgICAgaWYgKCFjYWNoZWRSZXZpZXdzLmxlbmd0aCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgZm9yIChjb25zdCBjYWNoZWRSZXZpZXcgb2YgY2FjaGVkUmV2aWV3cykge1xyXG5cclxuICAgICAgICB0aGlzLnN1Ym1pdFJldmlldyhjYWNoZWRSZXZpZXcsIChbb2sgPSBmYWxzZSwgcmV2aWV3XSA9IFtdKSA9PiB7XHJcblxyXG4gICAgICAgICAgaWYgKG9rKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVsZXRlQ2FjaGVkUmV2aWV3KGNhY2hlZFJldmlldy5jYWNoZV9pZCk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgfSkuY2F0Y2goZXJyb3IgPT4gY29uc29sZS5pbmZvKGBXYXNuJ3QgYWJsZSBnZXQgY2FjaGVkIHJldmlldyBzdWJtaXNzaW9ucyBvZiByZXN0YXVyYW50IElEOiAke3Jlc3RhdXJhbnRfaWR9YCwgZXJyb3IpKTtcclxuICB9XHJcblxyXG4gIHN1Ym1pdENhY2hlZEZhdm91cml0ZVJlc3RhdXJhbnQocmVzdGF1cmFudF9pZCkge1xyXG4gICAgY29uc3QgdGhpc2RiUHJvbWlzZSA9IHRoaXMuZGJQcm9taXNlO1xyXG4gICAgdGhpc2RiUHJvbWlzZS50aGVuKGRiID0+IHtcclxuICAgICAgcmV0dXJuIGRiLnRyYW5zYWN0aW9uKCdmYXZvdXJpdGUtdG8tc3VibWl0Jykub2JqZWN0U3RvcmUoJ2Zhdm91cml0ZS10by1zdWJtaXQnKS5nZXQocmVzdGF1cmFudF9pZCk7XHJcbiAgICB9KS50aGVuKGNhY2hlZFJlc3RhdXJhbnQgPT4ge1xyXG4gICAgICBpZiAoY2FjaGVkUmVzdGF1cmFudCkge1xyXG4gICAgICAgIHRoaXMudG9nZ2xlZmF2b3VyaXRlUmVzdGF1cmFudChyZXN0YXVyYW50X2lkLCBjYWNoZWRSZXN0YXVyYW50LmlzX2Zhdm9yaXRlLCBmdW5jdGlvbihvaykge1xyXG4gICAgICAgICAgaWYgKG9rKSB7XHJcbiAgICAgICAgICAgIHRoaXNkYlByb21pc2UudGhlbihkYiA9PiB7XHJcbiAgICAgICAgICAgICAgZGIudHJhbnNhY3Rpb24oJ2Zhdm91cml0ZS10by1zdWJtaXQnLCAncmVhZHdyaXRlJykub2JqZWN0U3RvcmUoJ2Zhdm91cml0ZS10by1zdWJtaXQnKS5kZWxldGUocmVzdGF1cmFudF9pZCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHRvZ2dsZWZhdm91cml0ZVJlc3RhdXJhbnQocmVzdGF1cmFudF9pZCwgY2hlY2tlZCwgY2FsbGJhY2spIHtcclxuICAgIGZldGNoKHRoaXMuREFUQUJBU0VfVVJMICsgYHJlc3RhdXJhbnRzLyR7cmVzdGF1cmFudF9pZH0vP2lzX2Zhdm9yaXRlPSR7Y2hlY2tlZH1gLCB7XHJcbiAgICAgICAgbWV0aG9kOiAnUFVUJ1xyXG4gICAgICB9KS50aGVuKHJhd0RhdGEgPT4gcmF3RGF0YS5qc29uKCkpXHJcbiAgICAgIC50aGVuKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgICAgIHRoaXMuZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xyXG4gICAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgICB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKS5wdXQocmVzdGF1cmFudCk7XHJcbiAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgY2FsbGJhY2sodHguY29tcGxldGUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgIHRoaXMuZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xyXG4gICAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbignZmF2b3VyaXRlLXRvLXN1Ym1pdCcsICdyZWFkd3JpdGUnKTtcclxuICAgICAgICAgIHR4Lm9iamVjdFN0b3JlKCdmYXZvdXJpdGUtdG8tc3VibWl0JywgJ3JlYWR3cml0ZScpLnB1dCh7XHJcbiAgICAgICAgICAgIHJlc3RhdXJhbnRfaWQ6IHJlc3RhdXJhbnRfaWQsXHJcbiAgICAgICAgICAgIGlzX2Zhdm9yaXRlOiBjaGVja2VkXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBjYWxsYmFjayhmYWxzZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxufVxyXG4iXX0=
