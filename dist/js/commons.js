"use strict";!function(){function u(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function i(n,o,r){var i,e=new Promise(function(e,t){u(i=n[o].apply(n,r)).then(e,t)});return e.request=i,e}function e(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function t(t,n,o,e){e.forEach(function(e){e in o.prototype&&(t.prototype[e]=function(){return i(this[n],e,arguments)})})}function n(t,n,o,e){e.forEach(function(e){e in o.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function o(e,o,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[o],(t=i(e,n,arguments)).then(function(e){if(e)return new c(e,t.request)});var e,t})})}function r(e){this._index=e}function c(e,t){this._cursor=e,this._request=t}function s(e){this._store=e}function a(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function p(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new a(n)}function f(e){this._db=e}e(r,"_index",["name","keyPath","multiEntry","unique"]),t(r,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),o(r,"_index",IDBIndex,["openCursor","openKeyCursor"]),e(c,"_cursor",["direction","key","primaryKey","value"]),t(c,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(c.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),u(t._request).then(function(e){if(e)return new c(e,t._request)})})})}),s.prototype.createIndex=function(){return new r(this._store.createIndex.apply(this._store,arguments))},s.prototype.index=function(){return new r(this._store.index.apply(this._store,arguments))},e(s,"_store",["name","keyPath","indexNames","autoIncrement"]),t(s,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),o(s,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(s,"_store",IDBObjectStore,["deleteIndex"]),a.prototype.objectStore=function(){return new s(this._tx.objectStore.apply(this._tx,arguments))},e(a,"_tx",["objectStoreNames","mode"]),n(a,"_tx",IDBTransaction,["abort"]),p.prototype.createObjectStore=function(){return new s(this._db.createObjectStore.apply(this._db,arguments))},e(p,"_db",["name","version","objectStoreNames"]),n(p,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new a(this._db.transaction.apply(this._db,arguments))},e(f,"_db",["name","version","objectStoreNames"]),n(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(i){[s,r].forEach(function(e){e.prototype[i.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],o=this._store||this._index,r=o[i].apply(o,t.slice(0,-1));r.onsuccess=function(){n(r.result)}}})}),[r,s].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var o=this,r=[];return new Promise(function(t){o.iterateCursor(e,function(e){e?(r.push(e.value),void 0===n||r.length!=n?e.continue():t(r)):t(r)})})})});var d={open:function(e,t,n){var o=i(indexedDB,"open",[e,t]),r=o.request;return r.onupgradeneeded=function(e){n&&n(new p(r.result,e.oldVersion,r.transaction))},o.then(function(e){return new f(e)})},delete:function(e){return i(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=d,module.exports.default=module.exports):self.idb=d}();
"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:"fetchRestaurants",value:function(t){fetch(n.DATABASE_URL).then(function(e){return e.json()}).then(function(e){return t([!0,e])}).catch(function(e){return t([!1,e])})}},{key:"fetchRestaurantById",value:function(o,u){n.fetchRestaurants(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=_slicedToArray(e,2),n=t[0],r=void 0!==n&&n,a=t[1];if(r){var i=a.find(function(e){return e.id==o});i?u(r,i):u(null,"Restaurant does not exist")}else u(!r,a)})}},{key:"fetchRestaurantByCuisine",value:function(o,u){n.fetchRestaurants(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=_slicedToArray(e,2),n=t[0],r=void 0!==n&&n,a=t[1];if(r){var i=a.filter(function(e){return e.cuisine_type==o});u(r,i)}else u(!r,a)})}},{key:"fetchRestaurantByNeighborhood",value:function(o,u){n.fetchRestaurants(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=_slicedToArray(e,2),n=t[0],r=void 0!==n&&n,a=t[1];if(r){var i=a.filter(function(e){return e.neighborhood==o});u(r,i)}else u(!r,a)})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(o,u,c){n.fetchRestaurants(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=_slicedToArray(e,2),n=t[0],r=void 0!==n&&n,a=t[1];if(r){var i=a;"all"!=o&&(i=i.filter(function(e){return e.cuisine_type==o})),"all"!=u&&(i=i.filter(function(e){return e.neighborhood==u})),c(r,i)}else c(!r,a)})}},{key:"fetchNeighborhoods",value:function(u){n.fetchRestaurants(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=_slicedToArray(e,2),n=t[0],r=void 0!==n&&n,a=t[1];if(r){var i=a.map(function(e,t){return a[t].neighborhood}),o=i.filter(function(e,t){return i.indexOf(e)==t});u(r,o)}else u(!r,a)})}},{key:"fetchCuisines",value:function(u){n.fetchRestaurants(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=_slicedToArray(e,2),n=t[0],r=void 0!==n&&n,a=t[1];if(r){var i=a.map(function(e,t){return a[t].cuisine_type}),o=i.filter(function(e,t){return i.indexOf(e)==t});u(r,o)}else u(!r,a)})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/img/"+e.photograph+".jpg"}},{key:"imageNameForRestaurant",value:function(e){return e.photograph.replace(/\.jpg$/,"")}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:n.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://192.168.1.132:1337/restaurants"}}]),n}();
"use strict";var _createClass=function(){function t(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var ServiceWorkerController=function(){function e(){_classCallCheck(this,e),this._registerServiceWorker()}return _createClass(e,[{key:"_registerServiceWorker",value:function(){navigator.serviceWorker&&navigator.serviceWorker.register("sw.js")}}]),e}();new ServiceWorkerController;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImlkYi5qcyIsImRiaGVscGVyLmpzIiwiU2VydmljZVdvcmtlckNvbnRyb2xsZXIuanMiXSwibmFtZXMiOlsicHJvbWlzaWZ5UmVxdWVzdCIsInJlcXVlc3QiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9uc3VjY2VzcyIsInJlc3VsdCIsIm9uZXJyb3IiLCJlcnJvciIsInByb21pc2lmeVJlcXVlc3RDYWxsIiwib2JqIiwibWV0aG9kIiwiYXJncyIsInAiLCJhcHBseSIsInRoZW4iLCJwcm94eVByb3BlcnRpZXMiLCJQcm94eUNsYXNzIiwidGFyZ2V0UHJvcCIsInByb3BlcnRpZXMiLCJmb3JFYWNoIiwicHJvcCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwicHJvdG90eXBlIiwiZ2V0IiwidGhpcyIsInNldCIsInZhbCIsInByb3h5UmVxdWVzdE1ldGhvZHMiLCJDb25zdHJ1Y3RvciIsImFyZ3VtZW50cyIsInByb3h5TWV0aG9kcyIsInByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMiLCJ2YWx1ZSIsIkN1cnNvciIsIkluZGV4IiwiaW5kZXgiLCJfaW5kZXgiLCJfY3Vyc29yIiwiY3Vyc29yIiwiY29tcGxldGUiLCJzdG9yZSIsImlkYlRyYW5zYWN0aW9uIiwiVHJhbnNhY3Rpb24iLCJfdHgiLCJvbmNvbXBsZXRlIiwib25hYm9ydCIsIk9iamVjdFN0b3JlIiwiaXRlbXMiLCJkYiIsIm9sZFZlcnNpb24iLCJ0cmFuc2FjdGlvbiIsIl9kYiIsImluc3RhbmNlIiwiaXRlcmF0ZUN1cnNvciIsIm9wZW4iLCJEQiIsIklEQkluZGV4IiwiSURCQ3Vyc29yIiwibWV0aG9kTmFtZSIsIl9yZXF1ZXN0IiwiSURCT2JqZWN0U3RvcmUiLCJfc3RvcmUiLCJJREJUcmFuc2FjdGlvbiIsIlVwZ3JhZGVEQiIsIm5hdGl2ZU9iamVjdCIsImZ1bmNOYW1lIiwib2JqZWN0U3RvcmUiLCJjcmVhdGVPYmplY3RTdG9yZSIsImNvdW50IiwidW5kZWZpbmVkIiwiSURCRGF0YWJhc2UiLCJvbnVwZ3JhZGVuZWVkZWQiLCJ1cGdyYWRlQ2FsbGJhY2siLCJkZWxldGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGVmYXVsdCIsInJlcGxhY2UiLCJzZWxmIiwiYXJyIiwiQXJyYXkiLCJzbGljZSIsImNhbGwiLCJjYWxsYmFjayIsImxlbmd0aCIsImdldEFsbCIsInF1ZXJ5IiwicHVzaCIsImNvbnRpbnVlIiwiZXhwIiwibmFtZSIsInZlcnNpb24iLCJpbmRleGVkREIiLCJldmVudCIsImlkYiIsIkRCSGVscGVyIiwiZmV0Y2giLCJEQVRBQkFTRV9VUkwiLCJyZXNwb25zZSIsImpzb24iLCJkYXRhIiwiY2F0Y2giLCJpZCIsImZldGNoUmVzdGF1cmFudHMiLCJfcmVmIiwiX3JlZjIiLCJfc2xpY2VkVG9BcnJheSIsIl9yZWYyJCIsIm9rIiwicmVzdGF1cmFudCIsImZpbmQiLCJyIiwiY3Vpc2luZSIsIl9yZWYzIiwiX3JlZjQiLCJfcmVmNCQiLCJyZXN1bHRzIiwiZmlsdGVyIiwiY3Vpc2luZV90eXBlIiwibmVpZ2hib3Job29kIiwiX3JlZjUiLCJfcmVmNiIsIl9yZWY2JCIsIl9yZWY3IiwiX3JlZjgiLCJfcmVmOCQiLCJfcmVmOSIsIl9yZWYxMCIsIl9yZWYxMCQiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsImkiLCJpbmRleE9mIiwidW5pcXVlTmVpZ2hib3Job29kcyIsIl9yZWYxMSIsIl9yZWYxMiIsIl9yZWYxMiQiLCJjdWlzaW5lcyIsInVuaXF1ZUN1aXNpbmVzIiwicGhvdG9ncmFwaCIsImdvb2dsZSIsIm1hcHMiLCJNYXJrZXIiLCJwb3NpdGlvbiIsImxhdGxuZyIsInRpdGxlIiwidXJsIiwidXJsRm9yUmVzdGF1cmFudCIsImFuaW1hdGlvbiIsIkFuaW1hdGlvbiIsIkRST1AiLCJTZXJ2aWNlV29ya2VyQ29udHJvbGxlciIsIl9jbGFzc0NhbGxDaGVjayIsIl9yZWdpc3RlclNlcnZpY2VXb3JrZXIiLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0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R0FDZixNQUFBLHdCQUFNVyxFQUFBUCxpREFHSE8sR0FDRCxNQUFBLFFBQUFBLEVBQUErQixXQUFBLHNEQUVtQnZCLEdBQU8sT0FBQVIsRUFBS0UsV0FBRVEsUUFBZ0JBLFNBQXZCLG1EQUtoQ1YsRUFBQXFCLEdBbUVDLE9BUGUsSUFBSVcsT0FBT0MsS0FBS0MsT0FBTyxDQTFEeENDLFNBQUFuQyxFQUFBb0MsT0E0RElDLE1BQU9yQyxFQUFXbkIsS0FDbEJ5RCxJQUFLcEQsRUFBU3FELGlCQUFpQnZDLEdBQy9CcUIsSUFBS0EsRUFDTG1CLFVBQVdSLE9BQU9DLEtBQUtRLFVBQVVDLDRDQTVLakN4RCxNQUFBQTtpWUNIQXlELG1DQUVKLFNBQUFBLElBQWNDLGdCQUFBakksS0FBQWdJLEdBQ1poSSxLQUFLa0ksK0ZBQUFBLFVBQUFBLGVBQ05DLFVBQUFDLGNBQUFDLFNBQUEsa0JBV0gsSUFBSUwiLCJmaWxlIjoiY29tbW9ucy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbihmdW5jdGlvbigpIHtcclxuICBmdW5jdGlvbiB0b0FycmF5KGFycikge1xyXG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycik7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzdWx0KTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcclxuICAgIHZhciByZXF1ZXN0O1xyXG4gICAgdmFyIHAgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgcmVxdWVzdCA9IG9ialttZXRob2RdLmFwcGx5KG9iaiwgYXJncyk7XHJcbiAgICAgIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkudGhlbihyZXNvbHZlLCByZWplY3QpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcC5yZXF1ZXN0ID0gcmVxdWVzdDtcclxuICAgIHJldHVybiBwO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcclxuICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpO1xyXG4gICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICBpZiAoIXZhbHVlKSByZXR1cm47XHJcbiAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBwLnJlcXVlc3QpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBwcm94eVByb3BlcnRpZXMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgcHJvcGVydGllcykge1xyXG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcclxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFByb3h5Q2xhc3MucHJvdG90eXBlLCBwcm9wLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpIHtcclxuICAgICAgICAgIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0gPSB2YWw7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcHJveHlSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xyXG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcclxuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XHJcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb3h5TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xyXG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcclxuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XHJcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0uYXBwbHkodGhpc1t0YXJnZXRQcm9wXSwgYXJndW1lbnRzKTtcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xyXG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcclxuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XHJcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIEluZGV4KGluZGV4KSB7XHJcbiAgICB0aGlzLl9pbmRleCA9IGluZGV4O1xyXG4gIH1cclxuXHJcbiAgcHJveHlQcm9wZXJ0aWVzKEluZGV4LCAnX2luZGV4JywgW1xyXG4gICAgJ25hbWUnLFxyXG4gICAgJ2tleVBhdGgnLFxyXG4gICAgJ211bHRpRW50cnknLFxyXG4gICAgJ3VuaXF1ZSdcclxuICBdKTtcclxuXHJcbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXHJcbiAgICAnZ2V0JyxcclxuICAgICdnZXRLZXknLFxyXG4gICAgJ2dldEFsbCcsXHJcbiAgICAnZ2V0QWxsS2V5cycsXHJcbiAgICAnY291bnQnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xyXG4gICAgJ29wZW5DdXJzb3InLFxyXG4gICAgJ29wZW5LZXlDdXJzb3InXHJcbiAgXSk7XHJcblxyXG4gIGZ1bmN0aW9uIEN1cnNvcihjdXJzb3IsIHJlcXVlc3QpIHtcclxuICAgIHRoaXMuX2N1cnNvciA9IGN1cnNvcjtcclxuICAgIHRoaXMuX3JlcXVlc3QgPSByZXF1ZXN0O1xyXG4gIH1cclxuXHJcbiAgcHJveHlQcm9wZXJ0aWVzKEN1cnNvciwgJ19jdXJzb3InLCBbXHJcbiAgICAnZGlyZWN0aW9uJyxcclxuICAgICdrZXknLFxyXG4gICAgJ3ByaW1hcnlLZXknLFxyXG4gICAgJ3ZhbHVlJ1xyXG4gIF0pO1xyXG5cclxuICBwcm94eVJlcXVlc3RNZXRob2RzKEN1cnNvciwgJ19jdXJzb3InLCBJREJDdXJzb3IsIFtcclxuICAgICd1cGRhdGUnLFxyXG4gICAgJ2RlbGV0ZSdcclxuICBdKTtcclxuXHJcbiAgLy8gcHJveHkgJ25leHQnIG1ldGhvZHNcclxuICBbJ2FkdmFuY2UnLCAnY29udGludWUnLCAnY29udGludWVQcmltYXJ5S2V5J10uZm9yRWFjaChmdW5jdGlvbihtZXRob2ROYW1lKSB7XHJcbiAgICBpZiAoIShtZXRob2ROYW1lIGluIElEQkN1cnNvci5wcm90b3R5cGUpKSByZXR1cm47XHJcbiAgICBDdXJzb3IucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIHZhciBjdXJzb3IgPSB0aGlzO1xyXG4gICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgY3Vyc29yLl9jdXJzb3JbbWV0aG9kTmFtZV0uYXBwbHkoY3Vyc29yLl9jdXJzb3IsIGFyZ3MpO1xyXG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KGN1cnNvci5fcmVxdWVzdCkudGhlbihmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xyXG4gICAgICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIGN1cnNvci5fcmVxdWVzdCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuICB9KTtcclxuXHJcbiAgZnVuY3Rpb24gT2JqZWN0U3RvcmUoc3RvcmUpIHtcclxuICAgIHRoaXMuX3N0b3JlID0gc3RvcmU7XHJcbiAgfVxyXG5cclxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuY3JlYXRlSW5kZXggPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuY3JlYXRlSW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xyXG4gIH07XHJcblxyXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5pbmRleCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5pbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XHJcbiAgfTtcclxuXHJcbiAgcHJveHlQcm9wZXJ0aWVzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgW1xyXG4gICAgJ25hbWUnLFxyXG4gICAgJ2tleVBhdGgnLFxyXG4gICAgJ2luZGV4TmFtZXMnLFxyXG4gICAgJ2F1dG9JbmNyZW1lbnQnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xyXG4gICAgJ3B1dCcsXHJcbiAgICAnYWRkJyxcclxuICAgICdkZWxldGUnLFxyXG4gICAgJ2NsZWFyJyxcclxuICAgICdnZXQnLFxyXG4gICAgJ2dldEFsbCcsXHJcbiAgICAnZ2V0S2V5JyxcclxuICAgICdnZXRBbGxLZXlzJyxcclxuICAgICdjb3VudCdcclxuICBdKTtcclxuXHJcbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXHJcbiAgICAnb3BlbkN1cnNvcicsXHJcbiAgICAnb3BlbktleUN1cnNvcidcclxuICBdKTtcclxuXHJcbiAgcHJveHlNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcclxuICAgICdkZWxldGVJbmRleCdcclxuICBdKTtcclxuXHJcbiAgZnVuY3Rpb24gVHJhbnNhY3Rpb24oaWRiVHJhbnNhY3Rpb24pIHtcclxuICAgIHRoaXMuX3R4ID0gaWRiVHJhbnNhY3Rpb247XHJcbiAgICB0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgIH07XHJcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xyXG4gICAgICB9O1xyXG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmFib3J0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgVHJhbnNhY3Rpb24ucHJvdG90eXBlLm9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX3R4Lm9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX3R4LCBhcmd1bWVudHMpKTtcclxuICB9O1xyXG5cclxuICBwcm94eVByb3BlcnRpZXMoVHJhbnNhY3Rpb24sICdfdHgnLCBbXHJcbiAgICAnb2JqZWN0U3RvcmVOYW1lcycsXHJcbiAgICAnbW9kZSdcclxuICBdKTtcclxuXHJcbiAgcHJveHlNZXRob2RzKFRyYW5zYWN0aW9uLCAnX3R4JywgSURCVHJhbnNhY3Rpb24sIFtcclxuICAgICdhYm9ydCdcclxuICBdKTtcclxuXHJcbiAgZnVuY3Rpb24gVXBncmFkZURCKGRiLCBvbGRWZXJzaW9uLCB0cmFuc2FjdGlvbikge1xyXG4gICAgdGhpcy5fZGIgPSBkYjtcclxuICAgIHRoaXMub2xkVmVyc2lvbiA9IG9sZFZlcnNpb247XHJcbiAgICB0aGlzLnRyYW5zYWN0aW9uID0gbmV3IFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKTtcclxuICB9XHJcblxyXG4gIFVwZ3JhZGVEQi5wcm90b3R5cGUuY3JlYXRlT2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fZGIuY3JlYXRlT2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xyXG4gIH07XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhVcGdyYWRlREIsICdfZGInLCBbXHJcbiAgICAnbmFtZScsXHJcbiAgICAndmVyc2lvbicsXHJcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcclxuICBdKTtcclxuXHJcbiAgcHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXHJcbiAgICAnZGVsZXRlT2JqZWN0U3RvcmUnLFxyXG4gICAgJ2Nsb3NlJ1xyXG4gIF0pO1xyXG5cclxuICBmdW5jdGlvbiBEQihkYikge1xyXG4gICAgdGhpcy5fZGIgPSBkYjtcclxuICB9XHJcblxyXG4gIERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbih0aGlzLl9kYi50cmFuc2FjdGlvbi5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XHJcbiAgfTtcclxuXHJcbiAgcHJveHlQcm9wZXJ0aWVzKERCLCAnX2RiJywgW1xyXG4gICAgJ25hbWUnLFxyXG4gICAgJ3ZlcnNpb24nLFxyXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5TWV0aG9kcyhEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXHJcbiAgICAnY2xvc2UnXHJcbiAgXSk7XHJcblxyXG4gIC8vIEFkZCBjdXJzb3IgaXRlcmF0b3JzXHJcbiAgLy8gVE9ETzogcmVtb3ZlIHRoaXMgb25jZSBicm93c2VycyBkbyB0aGUgcmlnaHQgdGhpbmcgd2l0aCBwcm9taXNlc1xyXG4gIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10uZm9yRWFjaChmdW5jdGlvbihmdW5jTmFtZSkge1xyXG4gICAgW09iamVjdFN0b3JlLCBJbmRleF0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xyXG4gICAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGVbZnVuY05hbWUucmVwbGFjZSgnb3BlbicsICdpdGVyYXRlJyldID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7XHJcbiAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xyXG4gICAgICAgIHZhciBuYXRpdmVPYmplY3QgPSB0aGlzLl9zdG9yZSB8fCB0aGlzLl9pbmRleDtcclxuICAgICAgICB2YXIgcmVxdWVzdCA9IG5hdGl2ZU9iamVjdFtmdW5jTmFtZV0uYXBwbHkobmF0aXZlT2JqZWN0LCBhcmdzLnNsaWNlKDAsIC0xKSk7XHJcbiAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgIGNhbGxiYWNrKHJlcXVlc3QucmVzdWx0KTtcclxuICAgICAgICB9O1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIC8vIHBvbHlmaWxsIGdldEFsbFxyXG4gIFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcclxuICAgIGlmIChDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsKSByZXR1cm47XHJcbiAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsID0gZnVuY3Rpb24ocXVlcnksIGNvdW50KSB7XHJcbiAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XHJcbiAgICAgIHZhciBpdGVtcyA9IFtdO1xyXG5cclxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcclxuICAgICAgICBpbnN0YW5jZS5pdGVyYXRlQ3Vyc29yKHF1ZXJ5LCBmdW5jdGlvbihjdXJzb3IpIHtcclxuICAgICAgICAgIGlmICghY3Vyc29yKSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XHJcblxyXG4gICAgICAgICAgaWYgKGNvdW50ICE9PSB1bmRlZmluZWQgJiYgaXRlbXMubGVuZ3RoID09IGNvdW50KSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG4gIH0pO1xyXG5cclxuICB2YXIgZXhwID0ge1xyXG4gICAgb3BlbjogZnVuY3Rpb24obmFtZSwgdmVyc2lvbiwgdXBncmFkZUNhbGxiYWNrKSB7XHJcbiAgICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnb3BlbicsIFtuYW1lLCB2ZXJzaW9uXSk7XHJcbiAgICAgIHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xyXG5cclxuICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgIGlmICh1cGdyYWRlQ2FsbGJhY2spIHtcclxuICAgICAgICAgIHVwZ3JhZGVDYWxsYmFjayhuZXcgVXBncmFkZURCKHJlcXVlc3QucmVzdWx0LCBldmVudC5vbGRWZXJzaW9uLCByZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbihkYikge1xyXG4gICAgICAgIHJldHVybiBuZXcgREIoZGIpO1xyXG4gICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBkZWxldGU6IGZ1bmN0aW9uKG5hbWUpIHtcclxuICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ2RlbGV0ZURhdGFiYXNlJywgW25hbWVdKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgIG1vZHVsZS5leHBvcnRzID0gZXhwO1xyXG4gICAgbW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IG1vZHVsZS5leHBvcnRzO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBzZWxmLmlkYiA9IGV4cDtcclxuICB9XHJcbn0oKSk7IiwiLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxuY2xhc3MgREJIZWxwZXIge1xyXG5cclxuICAvKipcclxuICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xyXG4gICAgY29uc3QgcG9ydCA9IDEzMzcgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgcmV0dXJuIGBodHRwOi8vMTkyLjE2OC4xLjEzMjoke3BvcnR9L3Jlc3RhdXJhbnRzYDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xyXG4gICAgZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMKVxyXG4gICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcbiAgICAgIC50aGVuKGRhdGEgPT4gY2FsbGJhY2soW3RydWUsIGRhdGFdKSlcclxuICAgICAgLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKFtmYWxzZSwgZXJyb3JdKSk7XHJcblxyXG4gICAgLypcclxuICAgIGxldCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgIHhoci5vcGVuKCdHRVQnLCBEQkhlbHBlci5EQVRBQkFTRV9VUkwpO1xyXG4gICAgeGhyLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgaWYgKHhoci5zdGF0dXMgPT09IDIwMCkgeyAvLyBHb3QgYSBzdWNjZXNzIHJlc3BvbnNlIGZyb20gc2VydmVyIVxyXG4gICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xyXG4gICAgICAgIGNvbnN0IHJlc3RhdXJhbnRzID0ganNvbi5yZXN0YXVyYW50cztcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XHJcbiAgICAgIH0gZWxzZSB7IC8vIE9vcHMhLiBHb3QgYW4gZXJyb3IgZnJvbSBzZXJ2ZXIuXHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSAoYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHt4aHIuc3RhdHVzfWApO1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHhoci5zZW5kKCk7XHJcbiAgICAqL1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKFtvayA9IGZhbHNlLCByZXNwb25zZV0gPSBbXSkgPT4ge1xyXG4gICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgY2FsbGJhY2soIW9rLCByZXNwb25zZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3BvbnNlLmZpbmQociA9PiByLmlkID09IGlkKTtcclxuICAgICAgICBpZiAocmVzdGF1cmFudCkgeyAvLyBHb3QgdGhlIHJlc3RhdXJhbnRcclxuICAgICAgICAgIGNhbGxiYWNrKG9rLCByZXN0YXVyYW50KTtcclxuICAgICAgICB9IGVsc2UgeyAvLyBSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZVxyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoW29rID0gZmFsc2UsIHJlc3BvbnNlXSA9IFtdKSA9PiB7XHJcbiAgICAgIGlmICghb2spIHtcclxuICAgICAgICBjYWxsYmFjayghb2ssIHJlc3BvbnNlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXNwb25zZS5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICBjYWxsYmFjayhvaywgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoW29rID0gZmFsc2UsIHJlc3BvbnNlXSA9IFtdKSA9PiB7XHJcbiAgICAgIGlmICghb2spIHtcclxuICAgICAgICBjYWxsYmFjayghb2ssIHJlc3BvbnNlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXNwb25zZS5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIGNhbGxiYWNrKG9rLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChbb2sgPSBmYWxzZSwgcmVzcG9uc2VdID0gW10pID0+IHtcclxuICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgIGNhbGxiYWNrKCFvaywgcmVzcG9uc2UpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzcG9uc2U7XHJcbiAgICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhbGxiYWNrKG9rLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKFtvayA9IGZhbHNlLCByZXNwb25zZV0gPSBbXSkgPT4ge1xyXG4gICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgY2FsbGJhY2soIW9rLCByZXNwb25zZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3BvbnNlLm1hcCgodiwgaSkgPT4gcmVzcG9uc2VbaV0ubmVpZ2hib3Job29kKVxyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcigodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGkpXHJcbiAgICAgICAgY2FsbGJhY2sob2ssIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChbb2sgPSBmYWxzZSwgcmVzcG9uc2VdID0gW10pID0+IHtcclxuICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgIGNhbGxiYWNrKCFvaywgcmVzcG9uc2UpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3BvbnNlLm1hcCgodiwgaSkgPT4gcmVzcG9uc2VbaV0uY3Vpc2luZV90eXBlKVxyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcclxuICAgICAgICBjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKVxyXG4gICAgICAgIGNhbGxiYWNrKG9rLCB1bmlxdWVDdWlzaW5lcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9LmpwZ2ApO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGltYWdlTmFtZUZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIHJlc3RhdXJhbnQucGhvdG9ncmFwaC5yZXBsYWNlKC9cXC5qcGckLywgJycpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxyXG4gICAgICBtYXA6IG1hcCxcclxuICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gbWFya2VyO1xyXG4gIH1cclxuXHJcbn0iLCJjbGFzcyBTZXJ2aWNlV29ya2VyQ29udHJvbGxlciB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5fcmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiAgUmVnaXN0ZXIgdGhlIFNlcnZpY2UgV29ya2VyXHJcbiAgICovXHJcbiAgX3JlZ2lzdGVyU2VydmljZVdvcmtlcigpIHtcclxuICAgIGlmICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHJldHVybjtcclxuICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCdzdy5qcycpO1xyXG4gIH1cclxufVxyXG5cclxubmV3IFNlcnZpY2VXb3JrZXJDb250cm9sbGVyKCk7XHJcbiJdfQ==
