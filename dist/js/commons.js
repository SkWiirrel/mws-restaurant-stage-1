"use strict";!function(){function u(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function i(n,o,r){var i,e=new Promise(function(e,t){u(i=n[o].apply(n,r)).then(e,t)});return e.request=i,e}function e(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function t(t,n,o,e){e.forEach(function(e){e in o.prototype&&(t.prototype[e]=function(){return i(this[n],e,arguments)})})}function n(t,n,o,e){e.forEach(function(e){e in o.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function o(e,o,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[o],(t=i(e,n,arguments)).then(function(e){if(e)return new c(e,t.request)});var e,t})})}function r(e){this._index=e}function c(e,t){this._cursor=e,this._request=t}function s(e){this._store=e}function a(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function p(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new a(n)}function f(e){this._db=e}e(r,"_index",["name","keyPath","multiEntry","unique"]),t(r,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),o(r,"_index",IDBIndex,["openCursor","openKeyCursor"]),e(c,"_cursor",["direction","key","primaryKey","value"]),t(c,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(c.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),u(t._request).then(function(e){if(e)return new c(e,t._request)})})})}),s.prototype.createIndex=function(){return new r(this._store.createIndex.apply(this._store,arguments))},s.prototype.index=function(){return new r(this._store.index.apply(this._store,arguments))},e(s,"_store",["name","keyPath","indexNames","autoIncrement"]),t(s,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),o(s,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(s,"_store",IDBObjectStore,["deleteIndex"]),a.prototype.objectStore=function(){return new s(this._tx.objectStore.apply(this._tx,arguments))},e(a,"_tx",["objectStoreNames","mode"]),n(a,"_tx",IDBTransaction,["abort"]),p.prototype.createObjectStore=function(){return new s(this._db.createObjectStore.apply(this._db,arguments))},e(p,"_db",["name","version","objectStoreNames"]),n(p,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new a(this._db.transaction.apply(this._db,arguments))},e(f,"_db",["name","version","objectStoreNames"]),n(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(i){[s,r].forEach(function(e){e.prototype[i.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],o=this._store||this._index,r=o[i].apply(o,t.slice(0,-1));r.onsuccess=function(){n(r.result)}}})}),[r,s].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var o=this,r=[];return new Promise(function(t){o.iterateCursor(e,function(e){e?(r.push(e.value),void 0===n||r.length!=n?e.continue():t(r)):t(r)})})})});var d={open:function(e,t,n){var o=i(indexedDB,"open",[e,t]),r=o.request;return r.onupgradeneeded=function(e){n&&n(new p(r.result,e.oldVersion,r.transaction))},o.then(function(e){return new f(e)})},delete:function(e){return i(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=d,module.exports.default=module.exports):self.idb=d}();
"use strict";var _slicedToArray=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,a=!1,i=void 0;try{for(var o,u=t[Symbol.iterator]();!(n=(o=u.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){a=!0,i=t}finally{try{!n&&u.return&&u.return()}finally{if(a)throw i}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function t(){_classCallCheck(this,t),this.dbPromise=idb.open("restaurant-reviews",1,function(t){t.createObjectStore("restaurants",{keyPath:"id"}),t.createObjectStore("reviews",{keyPath:"id"}).createIndex("restaurant_id","restaurant_id")})}return _createClass(t,[{key:"fetchRestaurants",value:function(e){var r=this;this.dbPromise.then(function(t){return t.transaction("restaurants").objectStore("restaurants").getAll()}).then(function(t){e([!0,t]),fetch(r.DATABASE_URL+"restaurants").then(function(t){return t.json()}).then(function(c){e([!0,c]),r.dbPromise.then(function(t){var e=t.transaction("restaurants","readwrite"),r=e.objectStore("restaurants"),n=!0,a=!1,i=void 0;try{for(var o,u=c[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;r.put(s)}}catch(t){a=!0,i=t}finally{try{!n&&u.return&&u.return()}finally{if(a)throw i}}return e.complete})}).catch(function(t){return e([!1,t])})})}},{key:"fetchRestaurant",value:function(e,r){var n=this;this.dbPromise.then(function(t){return t.transaction("restaurants").objectStore("restaurants").get(parseInt(r))}).then(function(t){e([!0,t]),fetch(n.DATABASE_URL+"restaurants/"+r).then(function(t){return t.json()}).then(function(r){e([!0,r]),n.dbPromise.then(function(t){var e=t.transaction("restaurants","readwrite");return e.objectStore("restaurants").put(r),e.complete})}).catch(function(t){return e([!1,t])})})}},{key:"fetchRestaurantById",value:function(t,i){this.fetchRestaurant(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=_slicedToArray(t,2),r=e[0],n=void 0!==r&&r,a=e[1];i(n||!n,a)},t)}},{key:"fetchReviewsByRestaurantId",value:function(e,r){var n=this;this.dbPromise.then(function(t){return t.transaction("reviews").objectStore("reviews").index("restaurant_id").getAll(parseInt(e))}).then(function(t){console.log(t),r([!0,t]),fetch(n.DATABASE_URL+"reviews/?restaurant_id="+e).then(function(t){return t.json()}).then(function(c){r([!0,c]),n.dbPromise.then(function(t){var e=t.transaction("reviews","readwrite"),r=e.objectStore("reviews"),n=!0,a=!1,i=void 0;try{for(var o,u=c[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;r.put(s)}}catch(t){a=!0,i=t}finally{try{!n&&u.return&&u.return()}finally{if(a)throw i}}return e.complete})}).catch(function(t){return r([!1,t])})})}},{key:"fetchRestaurantByCuisine",value:function(o,u){this.fetchRestaurants(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=_slicedToArray(t,2),r=e[0],n=void 0!==r&&r,a=e[1];if(n){var i=a.filter(function(t){return t.cuisine_type==o});u(n,i)}else u(!n,a)})}},{key:"fetchRestaurantByNeighborhood",value:function(o,u){this.fetchRestaurants(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=_slicedToArray(t,2),r=e[0],n=void 0!==r&&r,a=e[1];if(n){var i=a.filter(function(t){return t.neighborhood==o});u(n,i)}else u(!n,a)})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(o,u,s){this.fetchRestaurants(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=_slicedToArray(t,2),r=e[0],n=void 0!==r&&r,a=e[1];if(n){var i=a;"all"!=o&&(i=i.filter(function(t){return t.cuisine_type==o})),"all"!=u&&(i=i.filter(function(t){return t.neighborhood==u})),s(n,i)}else s(!n,a)})}},{key:"fetchNeighborhoods",value:function(u){this.fetchRestaurants(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=_slicedToArray(t,2),r=e[0],n=void 0!==r&&r,a=e[1];if(n){var i=a.map(function(t,e){return a[e].neighborhood}),o=i.filter(function(t,e){return i.indexOf(t)==e});u(n,o)}else u(!n,a)})}},{key:"fetchCuisines",value:function(u){this.fetchRestaurants(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=_slicedToArray(t,2),r=e[0],n=void 0!==r&&r,a=e[1];if(n){var i=a.map(function(t,e){return a[e].cuisine_type}),o=i.filter(function(t,e){return i.indexOf(t)==e});u(n,o)}else u(!n,a)})}},{key:"urlForRestaurant",value:function(t){return"./restaurant.html?id="+t.id}},{key:"imageUrlForRestaurant",value:function(t){return"/img/"+t.photograph+".jpf"}},{key:"imageNameForRestaurant",value:function(t){return(t.photograph||"5.jpf").replace(/\.jpf$/,"")}},{key:"mapMarkerForRestaurant",value:function(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:this.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"//localhost:1337/"}}]),t}();
"use strict";var _createClass=function(){function t(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var ServiceWorkerController=function(){function e(){_classCallCheck(this,e),this._registerServiceWorker()}return _createClass(e,[{key:"_registerServiceWorker",value:function(){navigator.serviceWorker&&navigator.serviceWorker.register("sw.js")}}]),e}();new ServiceWorkerController;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImlkYi5qcyIsImRiaGVscGVyLmpzIiwiU2VydmljZVdvcmtlckNvbnRyb2xsZXIuanMiXSwibmFtZXMiOlsicHJvbWlzaWZ5UmVxdWVzdCIsInJlcXVlc3QiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9uc3VjY2VzcyIsInJlc3VsdCIsIm9uZXJyb3IiLCJlcnJvciIsInByb21pc2lmeVJlcXVlc3RDYWxsIiwib2JqIiwibWV0aG9kIiwiYXJncyIsInAiLCJhcHBseSIsInRoZW4iLCJwcm94eVByb3BlcnRpZXMiLCJQcm94eUNsYXNzIiwidGFyZ2V0UHJvcCIsInByb3BlcnRpZXMiLCJmb3JFYWNoIiwicHJvcCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwicHJvdG90eXBlIiwiZ2V0IiwidGhpcyIsInNldCIsInZhbCIsInByb3h5UmVxdWVzdE1ldGhvZHMiLCJDb25zdHJ1Y3RvciIsImFyZ3VtZW50cyIsInByb3h5TWV0aG9kcyIsInByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMiLCJ2YWx1ZSIsIkN1cnNvciIsIkluZGV4IiwiaW5kZXgiLCJfaW5kZXgiLCJfY3Vyc29yIiwiY3Vyc29yIiwiY29tcGxldGUiLCJzdG9yZSIsImlkYlRyYW5zYWN0aW9uIiwiVHJhbnNhY3Rpb24iLCJfdHgiLCJvbmNvbXBsZXRlIiwib25hYm9ydCIsIk9iamVjdFN0b3JlIiwiaXRlbXMiLCJkYiIsIm9sZFZlcnNpb24iLCJ0cmFuc2FjdGlvbiIsIl9kYiIsImluc3RhbmNlIiwiaXRlcmF0ZUN1cnNvciIsIm9wZW4iLCJEQiIsIklEQkluZGV4IiwiSURCQ3Vyc29yIiwibWV0aG9kTmFtZSIsIl9yZXF1ZXN0IiwiSURCT2JqZWN0U3RvcmUiLCJfc3RvcmUiLCJJREJUcmFuc2FjdGlvbiIsIlVwZ3JhZGVEQiIsIm5hdGl2ZU9iamVjdCIsImZ1bmNOYW1lIiwib2JqZWN0U3RvcmUiLCJjcmVhdGVPYmplY3RTdG9yZSIsImNvdW50IiwidW5kZWZpbmVkIiwiSURCRGF0YWJhc2UiLCJvbnVwZ3JhZGVuZWVkZWQiLCJ1cGdyYWRlQ2FsbGJhY2siLCJkZWxldGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGVmYXVsdCIsInJlcGxhY2UiLCJzZWxmIiwiYXJyIiwiQXJyYXkiLCJzbGljZSIsImNhbGwiLCJjYWxsYmFjayIsImxlbmd0aCIsImdldEFsbCIsInF1ZXJ5IiwicHVzaCIsImNvbnRpbnVlIiwiZXhwIiwibmFtZSIsInZlcnNpb24iLCJpbmRleGVkREIiLCJldmVudCIsImlkYiIsIkRCSGVscGVyIiwiX2NsYXNzQ2FsbENoZWNrIiwiZGJQcm9taXNlIiwidXBncmFkZURiIiwia2V5UGF0aCIsImNyZWF0ZUluZGV4IiwiX3RoaXMiLCJyZXN0YXVyYW50cyIsImZldGNoIiwiREFUQUJBU0VfVVJMIiwicmVzcG9uc2UiLCJqc29uIiwiZGF0YSIsInR4IiwiX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiIsIl9kaWRJdGVyYXRvckVycm9yIiwiX2l0ZXJhdG9yRXJyb3IiLCJfc3RlcCIsImVyciIsIl9pdGVyYXRvciIsInJldHVybiIsImNhdGNoIiwiaWQiLCJfdGhpczIiLCJyZXN0YXVyYW50IiwicGFyc2VJbnQiLCJwdXQiLCJmZXRjaFJlc3RhdXJhbnQiLCJfcmVmIiwiX3JlZjIiLCJfc2xpY2VkVG9BcnJheSIsIl9yZWYyJCIsIm9rIiwicmVzdGF1cmFudF9pZCIsIl90aGlzMyIsInJldmlld3MiLCJsb2ciLCJfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiIsIl9kaWRJdGVyYXRvckVycm9yMiIsIl9pdGVyYXRvckVycm9yMiIsIl9zdGVwMiIsIl9pdGVyYXRvcjIiLCJTeW1ib2wiLCJpdGVyYXRvciIsIm5leHQiLCJkb25lIiwicmV2aWV3IiwiY3Vpc2luZSIsImZldGNoUmVzdGF1cmFudHMiLCJfcmVmMyIsIl9yZWY0IiwiX3JlZjQkIiwiZmlsdGVyIiwiciIsImN1aXNpbmVfdHlwZSIsInJlc3VsdHMiLCJuZWlnaGJvcmhvb2QiLCJfcmVmNSIsIl9yZWY2IiwiX3JlZjYkIiwiY29uc29sZSIsIl9yZWY3IiwiX3JlZjgiLCJfcmVmOCQiLCJfcmVmOSIsIl9yZWYxMCIsIl9yZWYxMCQiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsImkiLCJ1bmlxdWVOZWlnaGJvcmhvb2RzIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJwaG90b2dyYXBoIiwiZ29vZ2xlIiwibWFwcyIsIk1hcmtlciIsInBvc2l0aW9uIiwibGF0bG5nIiwidXJsIiwidXJsRm9yUmVzdGF1cmFudCIsImFuaW1hdGlvbiIsIkRST1AiLCJTZXJ2aWNlV29ya2VyQ29udHJvbGxlciIsIl9yZWdpc3RlclNlcnZpY2VXb3JrZXIiLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiXSwibWFwcGluZ3MiOiJBQUFBLGNBRUMsV0FLQyxTQUFTQSxFQUFpQkMsR0FDeEIsT0FBTyxJQUFJQyxRQUFRLFNBQUFDLEVBQUFDLEdBQ2pCSCxFQUFRSSxVQUFZLFdBQ2xCRixFQUFRRixFQUFRSyxTQUdsQkwsRUFBUU0sUUFBVSxXQUNoQkgsRUFBT0gsRUFBUU8sVUFLckIsU0FBU0MsRUFBcUJDLEVBQUtDLEVBQVFDLEdBQ3pDLElBQUlYLEVBQ0FZLEVBQUksSUFBSVgsUUFBUSxTQUFBQyxFQUFBQyxHQUVsQkosRUFEQUMsRUFBVVMsRUFBSUMsR0FBUUcsTUFBTUosRUFBS0UsSUFDUEcsS0FBS1osRUFBU0MsS0FJMUMsT0FEQVMsRUFBRVosUUFBVUEsRUFDTFksRUFXVCxTQUFTRyxFQUFnQkMsRUFBWUMsRUFBWUMsR0FDL0NBLEVBQVdDLFFBQVEsU0FBQUMsR0FDakJDLE9BQU9DLGVBQWVOLEVBQVdPLFVBQVdILEVBQU0sQ0FDaERJLElBQUssV0FDSCxPQUFPQyxLQUFLUixHQUFZRyxJQUUxQk0sSUFBSyxTQUFBQyxHQUNIRixLQUFLUixHQUFZRyxHQUFRTyxPQU1qQyxTQUFTQyxFQUFvQlosRUFBWUMsRUFBWVksRUFBYVgsR0FDaEVBLEVBQVdDLFFBQVEsU0FBQUMsR0FD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XG4oZnVuY3Rpb24oKSB7XHJcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcclxuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XHJcbiAgICB2YXIgcmVxdWVzdDtcclxuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xyXG4gICAgICBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHAucmVxdWVzdCA9IHJlcXVlc3Q7XHJcbiAgICByZXR1cm4gcDtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XHJcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcclxuICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xyXG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcHJveHlQcm9wZXJ0aWVzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIHByb3BlcnRpZXMpIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24odmFsKSB7XHJcbiAgICAgICAgICB0aGlzW3RhcmdldFByb3BdW3Byb3BdID0gdmFsO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb3h5UmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBwcm94eU1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBJbmRleChpbmRleCkge1xyXG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcclxuICB9XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFtcclxuICAgICduYW1lJyxcclxuICAgICdrZXlQYXRoJyxcclxuICAgICdtdWx0aUVudHJ5JyxcclxuICAgICd1bmlxdWUnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xyXG4gICAgJ2dldCcsXHJcbiAgICAnZ2V0S2V5JyxcclxuICAgICdnZXRBbGwnLFxyXG4gICAgJ2dldEFsbEtleXMnLFxyXG4gICAgJ2NvdW50J1xyXG4gIF0pO1xyXG5cclxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcclxuICAgICdvcGVuQ3Vyc29yJyxcclxuICAgICdvcGVuS2V5Q3Vyc29yJ1xyXG4gIF0pO1xyXG5cclxuICBmdW5jdGlvbiBDdXJzb3IoY3Vyc29yLCByZXF1ZXN0KSB7XHJcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XHJcbiAgICB0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcclxuICB9XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgW1xyXG4gICAgJ2RpcmVjdGlvbicsXHJcbiAgICAna2V5JyxcclxuICAgICdwcmltYXJ5S2V5JyxcclxuICAgICd2YWx1ZSdcclxuICBdKTtcclxuXHJcbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhDdXJzb3IsICdfY3Vyc29yJywgSURCQ3Vyc29yLCBbXHJcbiAgICAndXBkYXRlJyxcclxuICAgICdkZWxldGUnXHJcbiAgXSk7XHJcblxyXG4gIC8vIHByb3h5ICduZXh0JyBtZXRob2RzXHJcbiAgWydhZHZhbmNlJywgJ2NvbnRpbnVlJywgJ2NvbnRpbnVlUHJpbWFyeUtleSddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kTmFtZSkge1xyXG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG4gICAgQ3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICB2YXIgY3Vyc29yID0gdGhpcztcclxuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGN1cnNvci5fY3Vyc29yW21ldGhvZE5hbWVdLmFwcGx5KGN1cnNvci5fY3Vyc29yLCBhcmdzKTtcclxuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICAgIGlmICghdmFsdWUpIHJldHVybjtcclxuICAgICAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBjdXJzb3IuX3JlcXVlc3QpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH07XHJcbiAgfSk7XHJcblxyXG4gIGZ1bmN0aW9uIE9iamVjdFN0b3JlKHN0b3JlKSB7XHJcbiAgICB0aGlzLl9zdG9yZSA9IHN0b3JlO1xyXG4gIH1cclxuXHJcbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmNyZWF0ZUluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcclxuICB9O1xyXG5cclxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuaW5kZXggPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuaW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xyXG4gIH07XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIFtcclxuICAgICduYW1lJyxcclxuICAgICdrZXlQYXRoJyxcclxuICAgICdpbmRleE5hbWVzJyxcclxuICAgICdhdXRvSW5jcmVtZW50J1xyXG4gIF0pO1xyXG5cclxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcclxuICAgICdwdXQnLFxyXG4gICAgJ2FkZCcsXHJcbiAgICAnZGVsZXRlJyxcclxuICAgICdjbGVhcicsXHJcbiAgICAnZ2V0JyxcclxuICAgICdnZXRBbGwnLFxyXG4gICAgJ2dldEtleScsXHJcbiAgICAnZ2V0QWxsS2V5cycsXHJcbiAgICAnY291bnQnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xyXG4gICAgJ29wZW5DdXJzb3InLFxyXG4gICAgJ29wZW5LZXlDdXJzb3InXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXHJcbiAgICAnZGVsZXRlSW5kZXgnXHJcbiAgXSk7XHJcblxyXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XHJcbiAgICB0aGlzLl90eCA9IGlkYlRyYW5zYWN0aW9uO1xyXG4gICAgdGhpcy5jb21wbGV0ZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICB9O1xyXG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcclxuICAgICAgfTtcclxuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XHJcbiAgfTtcclxuXHJcbiAgcHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgW1xyXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnLFxyXG4gICAgJ21vZGUnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbXHJcbiAgICAnYWJvcnQnXHJcbiAgXSk7XHJcblxyXG4gIGZ1bmN0aW9uIFVwZ3JhZGVEQihkYiwgb2xkVmVyc2lvbiwgdHJhbnNhY3Rpb24pIHtcclxuICAgIHRoaXMuX2RiID0gZGI7XHJcbiAgICB0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xyXG4gICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XHJcbiAgfVxyXG5cclxuICBVcGdyYWRlREIucHJvdG90eXBlLmNyZWF0ZU9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX2RiLmNyZWF0ZU9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcclxuICB9O1xyXG5cclxuICBwcm94eVByb3BlcnRpZXMoVXBncmFkZURCLCAnX2RiJywgW1xyXG4gICAgJ25hbWUnLFxyXG4gICAgJ3ZlcnNpb24nLFxyXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5TWV0aG9kcyhVcGdyYWRlREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xyXG4gICAgJ2RlbGV0ZU9iamVjdFN0b3JlJyxcclxuICAgICdjbG9zZSdcclxuICBdKTtcclxuXHJcbiAgZnVuY3Rpb24gREIoZGIpIHtcclxuICAgIHRoaXMuX2RiID0gZGI7XHJcbiAgfVxyXG5cclxuICBEQi5wcm90b3R5cGUudHJhbnNhY3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xyXG4gIH07XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFtcclxuICAgICduYW1lJyxcclxuICAgICd2ZXJzaW9uJyxcclxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xyXG4gIF0pO1xyXG5cclxuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xyXG4gICAgJ2Nsb3NlJ1xyXG4gIF0pO1xyXG5cclxuICAvLyBBZGQgY3Vyc29yIGl0ZXJhdG9yc1xyXG4gIC8vIFRPRE86IHJlbW92ZSB0aGlzIG9uY2UgYnJvd3NlcnMgZG8gdGhlIHJpZ2h0IHRoaW5nIHdpdGggcHJvbWlzZXNcclxuICBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddLmZvckVhY2goZnVuY3Rpb24oZnVuY05hbWUpIHtcclxuICAgIFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcclxuICAgICAgQ29uc3RydWN0b3IucHJvdG90eXBlW2Z1bmNOYW1lLnJlcGxhY2UoJ29wZW4nLCAnaXRlcmF0ZScpXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMpO1xyXG4gICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcclxuICAgICAgICB2YXIgbmF0aXZlT2JqZWN0ID0gdGhpcy5fc3RvcmUgfHwgdGhpcy5faW5kZXg7XHJcbiAgICAgICAgdmFyIHJlcXVlc3QgPSBuYXRpdmVPYmplY3RbZnVuY05hbWVdLmFwcGx5KG5hdGl2ZU9iamVjdCwgYXJncy5zbGljZSgwLCAtMSkpO1xyXG4gICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICBjYWxsYmFjayhyZXF1ZXN0LnJlc3VsdCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICAvLyBwb2x5ZmlsbCBnZXRBbGxcclxuICBbSW5kZXgsIE9iamVjdFN0b3JlXS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XHJcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xyXG4gICAgQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCA9IGZ1bmN0aW9uKHF1ZXJ5LCBjb3VudCkge1xyXG4gICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xyXG4gICAgICB2YXIgaXRlbXMgPSBbXTtcclxuXHJcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XHJcbiAgICAgICAgaW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24oY3Vyc29yKSB7XHJcbiAgICAgICAgICBpZiAoIWN1cnNvcikge1xyXG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xyXG5cclxuICAgICAgICAgIGlmIChjb3VudCAhPT0gdW5kZWZpbmVkICYmIGl0ZW1zLmxlbmd0aCA9PSBjb3VudCkge1xyXG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1zKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuICB9KTtcclxuXHJcbiAgdmFyIGV4cCA9IHtcclxuICAgIG9wZW46IGZ1bmN0aW9uKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xyXG4gICAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ29wZW4nLCBbbmFtZSwgdmVyc2lvbl0pO1xyXG4gICAgICB2YXIgcmVxdWVzdCA9IHAucmVxdWVzdDtcclxuXHJcbiAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgICBpZiAodXBncmFkZUNhbGxiYWNrKSB7XHJcbiAgICAgICAgICB1cGdyYWRlQ2FsbGJhY2sobmV3IFVwZ3JhZGVEQihyZXF1ZXN0LnJlc3VsdCwgZXZlbnQub2xkVmVyc2lvbiwgcmVxdWVzdC50cmFuc2FjdGlvbikpO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24oZGIpIHtcclxuICAgICAgICByZXR1cm4gbmV3IERCKGRiKTtcclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZGVsZXRlOiBmdW5jdGlvbihuYW1lKSB7XHJcbiAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdkZWxldGVEYXRhYmFzZScsIFtuYW1lXSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGV4cDtcclxuICAgIG1vZHVsZS5leHBvcnRzLmRlZmF1bHQgPSBtb2R1bGUuZXhwb3J0cztcclxuICB9IGVsc2Uge1xyXG4gICAgc2VsZi5pZGIgPSBleHA7XHJcbiAgfVxyXG59KCkpOyIsIi8qanNoaW50IGVzdmVyc2lvbjogNiAqL1xyXG5cclxuLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxuY2xhc3MgREJIZWxwZXIge1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuZGJQcm9taXNlID0gaWRiLm9wZW4oJ3Jlc3RhdXJhbnQtcmV2aWV3cycsIDEsIHVwZ3JhZGVEYiA9PiB7XHJcbiAgICAgIHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudHMnLCB7XHJcbiAgICAgICAga2V5UGF0aDogJ2lkJ1xyXG4gICAgICB9KTtcclxuICAgICAgdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXZpZXdzJywge1xyXG4gICAgICAgIGtleVBhdGg6ICdpZCdcclxuICAgICAgfSkuY3JlYXRlSW5kZXgoJ3Jlc3RhdXJhbnRfaWQnLCAncmVzdGF1cmFudF9pZCcpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAqL1xyXG4gIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNzsgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgcmV0dXJuIGAvL2xvY2FsaG9zdDoke3BvcnR9L2A7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBEQiBpZiBwb3NzaWJsZS5cclxuICAgKi9cclxuICBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcblxyXG4gICAgLy8gRmlyc3QgZ2V0IHJlc3RhdXJhbnRzIGZyb20gdGhlIGRhdGFiYXNlIGFuZCB0aGVuIGZyb20gdGhlIHdlYlxyXG4gICAgdGhpcy5kYlByb21pc2UudGhlbihkYiA9PiB7XHJcblxyXG4gICAgICByZXR1cm4gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJykub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJykuZ2V0QWxsKCk7XHJcblxyXG4gICAgfSkudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcblxyXG4gICAgICAvLyBEaXNwbGF5IHJlc3RhdXJhbnRzIGZyb20gdGhlIGRhdGFiYXNlXHJcbiAgICAgIGNhbGxiYWNrKFt0cnVlLCByZXN0YXVyYW50c10pO1xyXG5cclxuICAgICAgLy8gR2V0IHJlc3RhdXJhbnRzIGZyb20gdGhlIHdlYlxyXG4gICAgICBmZXRjaCh0aGlzLkRBVEFCQVNFX1VSTCArICdyZXN0YXVyYW50cycpXHJcbiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxyXG4gICAgICAgIC50aGVuKGRhdGEgPT4ge1xyXG4gICAgICAgICAgY2FsbGJhY2soW3RydWUsIGRhdGFdKTtcclxuXHJcbiAgICAgICAgICAvLyBBZGQgcmVzdGF1cmFudHMgZnJvbSB0aGUgd2ViIHRvIHRoZSBkYXRhYmFzZVxyXG4gICAgICAgICAgdGhpcy5kYlByb21pc2UudGhlbihkYiA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgICAgICBjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xyXG5cclxuICAgICAgICAgICAgZm9yIChjb25zdCByZXN0YXVyYW50IG9mIGRhdGEpIHtcclxuICAgICAgICAgICAgICBzdG9yZS5wdXQocmVzdGF1cmFudCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKFtmYWxzZSwgZXJyb3JdKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50IGJ5IElEIGZyb20gREIgaWYgcG9zc2libGUuXHJcbiAgICovXHJcbiAgZmV0Y2hSZXN0YXVyYW50KGNhbGxiYWNrLCBpZCkge1xyXG5cclxuICAgIC8vIEZpcnN0IGdldCByZXN0YXVyYW50cyBmcm9tIHRoZSBkYXRhYmFzZSBhbmQgdGhlbiBmcm9tIHRoZSB3ZWJcclxuICAgIHRoaXMuZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xyXG4gICAgICByZXR1cm4gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJykub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJykuZ2V0KHBhcnNlSW50KGlkKSk7XHJcbiAgICB9KS50aGVuKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgICAvLyBEaXNwbGF5IHJlc3RhdXJhbnRzIGZyb20gdGhlIGRhdGFiYXNlXHJcbiAgICAgIGNhbGxiYWNrKFt0cnVlLCByZXN0YXVyYW50XSk7XHJcblxyXG4gICAgICAvLyBHZXQgcmVzdGF1cmFudHMgZnJvbSB0aGUgd2ViXHJcbiAgICAgIGZldGNoKHRoaXMuREFUQUJBU0VfVVJMICsgYHJlc3RhdXJhbnRzLyR7aWR9YClcclxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcbiAgICAgICAgLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgICAgICBjYWxsYmFjayhbdHJ1ZSwgZGF0YV0pO1xyXG5cclxuICAgICAgICAgIC8vIEFkZCByZXN0YXVyYW50cyBmcm9tIHRoZSB3ZWIgdG8gdGhlIGRhdGFiYXNlXHJcbiAgICAgICAgICB0aGlzLmRiUHJvbWlzZS50aGVuKGRiID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgICAgIHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpLnB1dChkYXRhKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKFtmYWxzZSwgZXJyb3JdKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXHJcbiAgICovXHJcbiAgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgIHRoaXMuZmV0Y2hSZXN0YXVyYW50KChbb2sgPSBmYWxzZSwgcmVzcG9uc2VdID0gW10pID0+IHtcclxuICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgIGNhbGxiYWNrKCFvaywgcmVzcG9uc2UpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG9rLCByZXNwb25zZSk7XHJcbiAgICAgIH1cclxuICAgIH0sIGlkKTtcclxuICB9XHJcblxyXG4gIGZldGNoUmV2aWV3c0J5UmVzdGF1cmFudElkKHJlc3RhdXJhbnRfaWQsIGNhbGxiYWNrKSB7XHJcblxyXG4gICAgdGhpcy5kYlByb21pc2UudGhlbihkYiA9PiB7XHJcbiAgICAgIHJldHVybiBkYi50cmFuc2FjdGlvbigncmV2aWV3cycpLm9iamVjdFN0b3JlKCdyZXZpZXdzJykuaW5kZXgoJ3Jlc3RhdXJhbnRfaWQnKS5nZXRBbGwocGFyc2VJbnQocmVzdGF1cmFudF9pZCkpO1xyXG4gICAgfSkudGhlbihyZXZpZXdzID0+IHtcclxuICAgICAgY29uc29sZS5sb2cocmV2aWV3cyk7XHJcbiAgICAgIC8vIERpc3BsYXkgcmVzdGF1cmFudHMgZnJvbSB0aGUgZGF0YWJhc2VcclxuICAgICAgY2FsbGJhY2soW3RydWUsIHJldmlld3NdKTtcclxuXHJcbiAgICAgIC8vIEdldCByZXN0YXVyYW50cyBmcm9tIHRoZSB3ZWJcclxuICAgICAgZmV0Y2godGhpcy5EQVRBQkFTRV9VUkwgKyBgcmV2aWV3cy8/cmVzdGF1cmFudF9pZD0ke3Jlc3RhdXJhbnRfaWR9YClcclxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcbiAgICAgICAgLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgICAgICBjYWxsYmFjayhbdHJ1ZSwgZGF0YV0pO1xyXG5cclxuICAgICAgICAgIC8vIEFkZCByZXN0YXVyYW50cyBmcm9tIHRoZSB3ZWIgdG8gdGhlIGRhdGFiYXNlXHJcbiAgICAgICAgICB0aGlzLmRiUHJvbWlzZS50aGVuKGRiID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncmV2aWV3cycsICdyZWFkd3JpdGUnKTtcclxuICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmV2aWV3cycpO1xyXG5cclxuICAgICAgICAgICAgZm9yIChjb25zdCByZXZpZXcgb2YgZGF0YSkge1xyXG4gICAgICAgICAgICAgIHN0b3JlLnB1dChyZXZpZXcpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChlcnJvciA9PiBjYWxsYmFjayhbZmFsc2UsIGVycm9yXSkpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgIHRoaXMuZmV0Y2hSZXN0YXVyYW50cygoW29rID0gZmFsc2UsIHJlc3BvbnNlXSA9IFtdKSA9PiB7XHJcbiAgICAgIGlmICghb2spIHtcclxuICAgICAgICBjYWxsYmFjayghb2ssIHJlc3BvbnNlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXNwb25zZS5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICBjYWxsYmFjayhvaywgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICB0aGlzLmZldGNoUmVzdGF1cmFudHMoKFtvayA9IGZhbHNlLCByZXNwb25zZV0gPSBbXSkgPT4ge1xyXG4gICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgY2FsbGJhY2soIW9rLCByZXNwb25zZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2RcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzcG9uc2UuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICBjYWxsYmFjayhvaywgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICB0aGlzLmZldGNoUmVzdGF1cmFudHMoKFtvayA9IGZhbHNlLCByZXNwb25zZV0gPSBbXSkgPT4ge1xyXG4gICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgY2FsbGJhY2soIW9rLCByZXNwb25zZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXNwb25zZTtcclxuICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FsbGJhY2sob2ssIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICB0aGlzLmZldGNoUmVzdGF1cmFudHMoKFtvayA9IGZhbHNlLCByZXNwb25zZV0gPSBbXSkgPT4ge1xyXG4gICAgICBpZiAoIW9rKSB7XHJcbiAgICAgICAgY2FsbGJhY2soIW9rLCByZXNwb25zZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3BvbnNlLm1hcCgodiwgaSkgPT4gcmVzcG9uc2VbaV0ubmVpZ2hib3Job29kKTtcclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcclxuICAgICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKTtcclxuICAgICAgICBjYWxsYmFjayhvaywgdW5pcXVlTmVpZ2hib3Job29kcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgdGhpcy5mZXRjaFJlc3RhdXJhbnRzKChbb2sgPSBmYWxzZSwgcmVzcG9uc2VdID0gW10pID0+IHtcclxuICAgICAgaWYgKCFvaykge1xyXG4gICAgICAgIGNhbGxiYWNrKCFvaywgcmVzcG9uc2UpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3BvbnNlLm1hcCgodiwgaSkgPT4gcmVzcG9uc2VbaV0uY3Vpc2luZV90eXBlKTtcclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSk7XHJcbiAgICAgICAgY2FsbGJhY2sob2ssIHVuaXF1ZUN1aXNpbmVzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9LmpwZmApO1xyXG4gIH1cclxuXHJcbiAgaW1hZ2VOYW1lRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKHJlc3RhdXJhbnQucGhvdG9ncmFwaCB8fCAnNS5qcGYnKS5yZXBsYWNlKC9cXC5qcGYkLywgJycpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICB1cmw6IHRoaXMudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcclxuICAgICAgbWFwOiBtYXAsXHJcbiAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1BcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIG1hcmtlcjtcclxuICB9XHJcblxyXG59XHJcbiIsImNsYXNzIFNlcnZpY2VXb3JrZXJDb250cm9sbGVyIHtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLl9yZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqICBSZWdpc3RlciB0aGUgU2VydmljZSBXb3JrZXJcclxuICAgKi9cclxuICBfcmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCkge1xyXG4gICAgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikgcmV0dXJuO1xyXG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJ3N3LmpzJyk7XHJcbiAgfVxyXG59XHJcblxyXG5uZXcgU2VydmljZVdvcmtlckNvbnRyb2xsZXIoKTtcclxuIl19
